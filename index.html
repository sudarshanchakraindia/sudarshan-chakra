<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudarshan Chakra - Find Service Providers Near You</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .map-container { height: 500px; width: 100%; border-radius: 12px; }
        .reg-map { height: 350px; width: 100%; border-radius: 8px; margin-top: 10px; }
        .lang-option { cursor: pointer; padding: 20px; border-radius: 12px; transition: all 0.3s; }
        .lang-option:hover { transform: scale(1.05); }
        .category-card { cursor: pointer; transition: all 0.3s; }
        .category-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .category-card.selected { border: 3px solid #ea580c; background: #fff7ed; }
        .star-rating { color: #fbbf24; }
    </style>
</head>
<body class="bg-gray-50">

    <!-- LANGUAGE SELECTOR MODAL -->
    <div id="languageModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-3xl font-bold text-center mb-2">ЁЯМП Select Your Language</h2>
            <p class="text-center text-gray-600 mb-8">рдЕрдкрдиреА рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ / Choose Your Language</p>
            
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <div class="lang-option bg-gradient-to-br from-orange-500 to-orange-600 text-white text-center" onclick="selectLanguage('en')">
                    <div class="text-4xl mb-2">ЁЯЗмЁЯЗз</div>
                    <div class="font-bold text-lg">English</div>
                </div>
                <div class="lang-option bg-gradient-to-br from-green-500 to-green-600 text-white text-center" onclick="selectLanguage('hi')">
                    <div class="text-4xl mb-2">ЁЯЗоЁЯЗ│</div>
                    <div class="font-bold text-lg">рд╣рд┐рдВрджреА</div>
                </div>
                <div class="lang-option bg-gradient-to-br from-blue-500 to-blue-600 text-white text-center" onclick="selectLanguage('bn')">
                    <div class="text-4xl mb-2">ЁЯЗоЁЯЗ│</div>
                    <div class="font-bold text-lg">ржмрж╛ржВрж▓рж╛</div>
                </div>
                <div class="lang-option bg-gradient-to-br from-yellow-500 to-yellow-600 text-white text-center" onclick="selectLanguage('gu')">
                    <div class="text-4xl mb-2">ЁЯЗоЁЯЗ│</div>
                    <div class="font-bold text-lg">ркЧрлБркЬрк░рк╛ркдрлА</div>
                </div>
                <div class="lang-option bg-gradient-to-br from-red-500 to-red-600 text-white text-center" onclick="selectLanguage('mr')">
                    <div class="text-4xl mb-2">ЁЯЗоЁЯЗ│</div>
                    <div class="font-bold text-lg">рдорд░рд╛рдареА</div>
                </div>
                <div class="lang-option bg-gradient-to-br from-purple-500 to-purple-600 text-white text-center" onclick="selectLanguage('kn')">
                    <div class="text-4xl mb-2">ЁЯЗоЁЯЗ│</div>
                    <div class="font-bold text-lg">р▓Хр▓ир│Нр▓ир▓б</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showPage('home')">
                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-lg">SC</div>
                <span class="text-2xl font-bold text-orange-600">Sudarshan Chakra</span>
            </div>
            <div class="flex gap-2 flex-wrap items-center">
                <button data-i18n="home" onclick="showPage('home')" class="px-3 py-2 text-gray-700 hover:text-orange-600 font-medium text-sm">Home</button>
                <button data-i18n="browse" onclick="showPage('browse')" class="px-3 py-2 text-gray-700 hover:text-orange-600 font-medium text-sm">Browse</button>
                <button data-i18n="map" onclick="showPage('map')" class="px-3 py-2 text-gray-700 hover:text-orange-600 font-medium text-sm">Map</button>
                <button onclick="showPage('myProfile')" class="px-3 py-2 text-gray-700 hover:text-orange-600 font-medium text-sm">My Profile</button>
                <button data-i18n="registerProvider" onclick="showPage('register')" class="px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm">Register Provider</button>
                <button data-i18n="registerSeeker" onclick="showPage('seeker')" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">Register Seeker</button>
                <button data-i18n="admin" onclick="showPage('admin')" class="px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">ЁЯФР Admin</button>
                <button onclick="changeLang()" class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 text-sm">ЁЯМП <span id="currentLang">EN</span></button>
            </div>
        </div>
    </nav>

    <!-- HOME PAGE -->
    <div id="page-home" class="page">
        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-gray-800 mb-4">Find the Perfect Service Provider Near You</h1>
                <p class="text-xl text-gray-600 mb-8">Rated, verified professionals in your area</p>
                <div class="flex gap-4 justify-center flex-wrap">
                    <button data-i18n="browseServices" onclick="showPage('browse')" class="bg-orange-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-orange-700 text-lg">Browse Services</button>
                    <button data-i18n="becomeProvider" onclick="showPage('register')" class="bg-white text-orange-600 border-2 border-orange-600 px-8 py-3 rounded-lg font-semibold hover:bg-orange-50 text-lg">Become a Provider</button>
                    
                    <!-- PHASE C: Voice Search Button -->
                    <button data-i18n="voiceSearch" onclick="startVoiceSearch()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 text-lg">
                        ЁЯОд Voice Search
                    </button>
                </div>
                
                <!-- Voice Search Status -->
                <div id="voiceStatus" class="hidden mt-4 text-center">
                    <div class="inline-block bg-red-100 border border-red-300 rounded-lg px-6 py-3">
                        <div class="flex items-center gap-3">
                            <div class="animate-pulse">ЁЯФ┤</div>
                            <span id="voiceStatusText" class="font-medium text-red-800">Listening...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2 data-i18n="serviceCategories" class="text-2xl font-bold text-gray-800 mb-6 text-center">Service Categories</h2>
            <div id="categoriesGridHome" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>
    </div>

    <!-- NEW BROWSE PAGE WITH GRID VIEW -->
    <div id="page-browse" class="page hidden">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Find Service Providers Near You</h1>
            
            <!-- Step 1: Category Selection Grid -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-700 mb-4">1я╕ПтГг Select Category</h2>
                <div id="browseCategoriesGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
            </div>
            
            <!-- Step 2: Subcategory Selection Grid -->
            <div id="subcategorySection" class="mb-8 hidden">
                <h2 class="text-xl font-bold text-gray-700 mb-4">2я╕ПтГг Select Subcategory</h2>
                <div id="browseSubcategoriesGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
            </div>
            
            <!-- Step 3: Service Type Selection Grid -->
            <div id="serviceSection" class="mb-8 hidden">
                <h2 class="text-xl font-bold text-gray-700 mb-4">3я╕ПтГг Select Service Type</h2>
                <div id="browseServicesGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
            </div>
            
            <!-- Providers List (Sorted intelligently) -->
            <div id="providersSection" class="hidden">
                <!-- PHASE B: Sort & Filter Controls -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex flex-wrap gap-4 items-center">
                        <!-- Sort Dropdown -->
                        <div class="flex items-center gap-2">
                            <label data-i18n="sortBy" class="font-medium text-gray-700">Sort By</label>
                            <select id="sortSelect" onchange="applySortAndFilter()" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500">
                                <option value="rating" data-i18n="rating">Rating (High to Low)</option>
                                <option value="price" data-i18n="priceLowToHigh">Price (Low to High)</option>
                                <option value="distance" data-i18n="distanceNearToFar">Distance (Near to Far)</option>
                                <option value="experience" data-i18n="experienceHighToLow">Experience (High to Low)</option>
                            </select>
                        </div>
                        
                        <!-- Filter Button -->
                        <button data-i18n="filters" onclick="toggleFilters()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                            ЁЯФН Filters
                        </button>
                        
                        <!-- Results Count -->
                        <div id="resultsCount" class="ml-auto text-sm text-gray-600 font-medium"></div>
                    </div>
                    
                    <!-- Filter Panel (Hidden by default) -->
                    <div id="filterPanel" class="hidden mt-4 pt-4 border-t">
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <!-- Language Filter -->
                            <div>
                                <label data-i18n="languageFilter" class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                <select id="filterLanguage" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="" data-i18n="anyLanguage">Any Language</option>
                                    <option value="English">English</option>
                                    <option value="Hindi">рд╣рд┐рдВрджреА (Hindi)</option>
                                    <option value="Bengali">ржмрж╛ржВрж▓рж╛ (Bengali)</option>
                                    <option value="Gujarati">ркЧрлБркЬрк░рк╛ркдрлА (Gujarati)</option>
                                    <option value="Marathi">рдорд░рд╛рдареА (Marathi)</option>
                                    <option value="Kannada">р▓Хр▓ир│Нр▓ир▓б (Kannada)</option>
                                </select>
                            </div>
                            
                            <!-- Religion Filter -->
                            <div>
                                <label data-i18n="religionFilter" class="block text-sm font-medium text-gray-700 mb-2">Religion</label>
                                <select id="filterReligion" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="" data-i18n="anyReligion">Any Religion</option>
                                    <option value="Hindu">Hindu ЁЯХЙя╕П</option>
                                    <option value="Muslim">Muslim тШкя╕П</option>
                                    <option value="Christian">Christian тЬЭя╕П</option>
                                    <option value="Sikh">Sikh тШм</option>
                                    <option value="Buddhist">Buddhist тШ╕я╕П</option>
                                    <option value="Jain">Jain тШ╕я╕П</option>
                                </select>
                            </div>
                            
                            <!-- Price Range Filter -->
                            <div>
                                <label data-i18n="priceRange" class="block text-sm font-medium text-gray-700 mb-2">Price Range (тВ╣/hr)</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="filterPriceMin" placeholder="Min" class="w-full px-3 py-2 border rounded-lg" min="0" value="0">
                                    <span>-</span>
                                    <input type="number" id="filterPriceMax" placeholder="Max" class="w-full px-3 py-2 border rounded-lg" min="0" value="2000">
                                </div>
                            </div>
                            
                            <!-- Distance Filter -->
                            <div>
                                <label data-i18n="maxDistanceFilter" class="block text-sm font-medium text-gray-700 mb-2">Maximum Distance</label>
                                <select id="filterDistance" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="999">Any Distance</option>
                                    <option value="5">Within 5 km</option>
                                    <option value="10">Within 10 km</option>
                                    <option value="20">Within 20 km</option>
                                    <option value="50">Within 50 km</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Filter Action Buttons -->
                        <div class="flex gap-3 mt-4">
                            <button data-i18n="applyFilters" onclick="applySortAndFilter()" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium">
                                Apply Filters
                            </button>
                            <button data-i18n="clearFilters" onclick="clearFilters()" class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-medium">
                                Clear All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Provider Results -->
                <div id="providersGridNew" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <!-- Other pages remain similar, will add them below -->
    <!-- MAP PAGE (unchanged) -->
    <div id="page-map" class="page hidden">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">Service Providers & Seekers Map</h1>
                <button onclick="showPage('home')" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 font-semibold">
                    тЖР Back to Home
                </button>
            </div>
            <div id="mainMap" class="map-container bg-white rounded-xl shadow-md"></div>
        </div>
    </div>

    <!-- PROFILE, REGISTRATION PAGES - Simplified versions below -->
    <div id="page-myProfile" class="page hidden">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">My Profile</h1>
            <div class="bg-white rounded-xl shadow-md p-6">
                <div id="profileInfo"></div>
            </div>
        </div>
    </div>

    <!-- REGISTER PROVIDER (with rating field) -->
    <div id="page-register" class="page hidden">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Register as Service Provider</h1>
            
            <form id="providerForm" class="bg-white rounded-xl shadow-md p-6">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Full Name *</label>
                        <input type="text" id="providerName" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Mobile Number *</label>
                        <input type="tel" id="providerMobile" required pattern="[0-9]{10}" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Category (Optional)</label>
                        <select id="providerCategory" class="w-full px-4 py-2 border rounded-lg" onchange="updateProviderSubcategories()"></select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Subcategory (Optional)</label>
                        <select id="providerSubcategory" class="w-full px-4 py-2 border rounded-lg" onchange="updateProviderSubSubcategories()"></select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Service Type (Optional)</label>
                        <select id="providerSubSubcategory" class="w-full px-4 py-2 border rounded-lg"></select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Religion *</label>
                        <select id="providerReligion" required class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Select Religion</option>
                            <option value="Hindu">Hindu ЁЯХЙя╕П</option>
                            <option value="Muslim">Muslim тШкя╕П</option>
                            <option value="Christian">Christian тЬЭя╕П</option>
                            <option value="Sikh">Sikh тШм</option>
                            <option value="Buddhist">Buddhist тШ╕я╕П</option>
                            <option value="Jain">Jain тШ╕я╕П</option>
                        </select>
                    </div>
                    
                    <!-- PHASE B: Language Field -->
                    <div>
                        <label data-i18n="providerLanguage" class="block text-gray-700 font-medium mb-2">Provider Language *</label>
                        <select id="providerLanguage" required class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Select Language</option>
                            <option value="English">English</option>
                            <option value="Hindi">рд╣рд┐рдВрджреА (Hindi)</option>
                            <option value="Bengali">ржмрж╛ржВрж▓рж╛ (Bengali)</option>
                            <option value="Gujarati">ркЧрлБркЬрк░рк╛ркдрлА (Gujarati)</option>
                            <option value="Marathi">рдорд░рд╛рдареА (Marathi)</option>
                            <option value="Kannada">р▓Хр▓ир│Нр▓ир▓б (Kannada)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Experience (years) *</label>
                        <input type="number" id="providerExperience" required min="0" max="50" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Rate (тВ╣/hour) *</label>
                        <input type="number" id="providerRate" required min="50" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                
                <!-- PHASE B: Working Hours -->
                <div class="mt-6">
                    <label data-i18n="workingHours" class="block text-gray-700 font-medium mb-3">Working Hours *</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label class="border rounded-lg p-3 cursor-pointer hover:bg-orange-50 transition">
                            <input type="radio" name="workingHours" value="mon-fri" required class="mr-2">
                            <span data-i18n="monFri" class="font-medium">Mon-Fri (9 AM - 6 PM)</span>
                        </label>
                        <label class="border rounded-lg p-3 cursor-pointer hover:bg-orange-50 transition">
                            <input type="radio" name="workingHours" value="weekends" class="mr-2">
                            <span data-i18n="weekends" class="font-medium">Weekends Only</span>
                        </label>
                        <label class="border rounded-lg p-3 cursor-pointer hover:bg-orange-50 transition">
                            <input type="radio" name="workingHours" value="all-days" class="mr-2">
                            <span data-i18n="allDays" class="font-medium">All Days (7 days/week)</span>
                        </label>
                        <label class="border rounded-lg p-3 cursor-pointer hover:bg-orange-50 transition">
                            <input type="radio" name="workingHours" value="24x7" class="mr-2">
                            <span data-i18n="available24x7" class="font-medium">24├Ч7 Available</span>
                        </label>
                    </div>
                </div>
                
                <!-- PHASE B: Service Area -->
                <div class="mt-6">
                    <label data-i18n="serviceArea" class="block text-gray-700 font-medium mb-3">Service Area *</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="border rounded-lg p-3 cursor-pointer hover:bg-orange-50 transition">
                            <input type="radio" name="serviceArea" value="10km" required class="mr-2">
                            <span data-i18n="within10km" class="font-medium">Within 10 km</span>
                        </label>
                        <label class="border rounded-lg p-3 cursor-pointer hover:bg-orange-50 transition">
                            <input type="radio" name="serviceArea" value="city" class="mr-2">
                            <span data-i18n="withinCity" class="font-medium">Within City</span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-gray-700 font-medium mb-2">Location/Address *</label>
                    <input type="text" id="providerLocation" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div class="mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-700 font-medium">Set Your Location on Map</label>
                        <button type="button" onclick="useMyLocation('provider')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium">
                            ЁЯУН Use My Location
                        </button>
                    </div>
                    <div id="registerMap" class="reg-map bg-gray-100"></div>
                    <p class="text-sm text-gray-600 mt-2">Click "Use My Location" to auto-detect, or click/drag marker on map</p>
                    <input type="hidden" id="providerLat">
                    <input type="hidden" id="providerLng">
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold hover:bg-orange-700 text-lg">Register Now</button>
                </div>
            </form>
            
            <div id="providerSuccess" class="hidden mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
                тЬУ Registration successful!
            </div>
        </div>
    </div>

    <!-- REGISTER SEEKER (with location) -->
    <div id="page-seeker" class="page hidden">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Register as Service Seeker</h1>
            
            <form id="seekerForm" class="bg-white rounded-xl shadow-md p-6">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Full Name *</label>
                        <input type="text" id="seekerName" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Mobile Number *</label>
                        <input type="tel" id="seekerMobile" required pattern="[0-9]{10}" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Religion *</label>
                        <select id="seekerReligion" required class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Select Religion</option>
                            <option value="Hindu">Hindu ЁЯХЙя╕П</option>
                            <option value="Muslim">Muslim тШкя╕П</option>
                            <option value="Christian">Christian тЬЭя╕П</option>
                            <option value="Sikh">Sikh тШм</option>
                            <option value="Buddhist">Buddhist тШ╕я╕П</option>
                            <option value="Jain">Jain тШ╕я╕П</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-gray-700 font-medium mb-2">Location/Address *</label>
                    <input type="text" id="seekerLocation" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div class="mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-700 font-medium">Set Your Location on Map</label>
                        <button type="button" onclick="useMyLocation('seeker')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium">
                            ЁЯУН Use My Location
                        </button>
                    </div>
                    <div id="seekerMap" class="reg-map bg-gray-100"></div>
                    <p class="text-sm text-gray-600 mt-2">Click "Use My Location" to auto-detect, or click/drag marker on map</p>
                    <input type="hidden" id="seekerLat">
                    <input type="hidden" id="seekerLng">
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 text-lg">Register Now</button>
                </div>
            </form>
            
            <div id="seekerSuccess" class="hidden mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
                тЬУ Registration successful!
            </div>
        </div>
    </div>

    <!-- ADMIN PAGE -->
    <div id="page-admin" class="page hidden">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div id="adminLogin" class="max-w-md mx-auto">
                <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">ЁЯФР Admin Login</h1>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <input type="password" id="adminPassword" placeholder="Password: admin123" class="w-full px-4 py-2 border rounded-lg mb-4">
                    <button onclick="adminLogin()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700">Login</button>
                </div>
            </div>
            
            <div id="adminDashboard" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
                    <button onclick="adminLogout()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Logout</button>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-4xl font-bold" id="totalProviders">0</div>
                        <div class="mt-2 opacity-90">Total Providers</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-4xl font-bold" id="totalSeekers">0</div>
                        <div class="mt-2 opacity-90">Total Seekers</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-4xl font-bold" id="totalCategories">0</div>
                        <div class="mt-2 opacity-90">Total Categories</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                        <div class="text-4xl font-bold" id="totalRestricted">0</div>
                        <div class="mt-2 opacity-90">Restricted Users</div>
                    </div>
                </div>
                
                <!-- Tabs for different sections -->
                <div class="bg-white rounded-xl shadow-lg mb-6">
                    <div class="flex border-b">
                        <button onclick="showAdminTab('users')" id="tab-users" class="flex-1 px-6 py-4 font-semibold text-gray-600 hover:text-orange-600 border-b-2 border-transparent">
                            ЁЯСе User Management
                        </button>
                        <button onclick="showAdminTab('categories')" id="tab-categories" class="flex-1 px-6 py-4 font-semibold text-gray-600 hover:text-orange-600 border-b-2 border-orange-600">
                            ЁЯУЛ Category Management
                        </button>
                    </div>
                </div>
                
                <!-- USER MANAGEMENT TAB -->
                <div id="adminTab-users" class="hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">ЁЯСе Providers Management</h2>
                            <input type="text" id="searchProviders" placeholder="Search providers..." class="px-4 py-2 border rounded-lg" onkeyup="filterProvidersList()">
                        </div>
                        <div id="providersListAdmin" class="space-y-3"></div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">ЁЯСд Seekers Management</h2>
                            <input type="text" id="searchSeekers" placeholder="Search seekers..." class="px-4 py-2 border rounded-lg" onkeyup="filterSeekersList()">
                        </div>
                        <div id="seekersListAdmin" class="space-y-3"></div>
                    </div>
                </div>
                
                <!-- CATEGORY MANAGEMENT TAB -->
                <div id="adminTab-categories" class="">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">ЁЯУЛ Category Management</h2>
                            <div class="flex gap-2">
                                <button onclick="resetToDefaults()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-medium">
                                    ЁЯФД Reset to Defaults
                                </button>
                                <button onclick="showAddCategoryModal()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-semibold shadow">
                                    тЮХ Add New Category
                                </button>
                            </div>
                        </div>
                        
                        <div id="categoriesListAdmin" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODALS FOR ADMIN -->
    
    <!-- Add/Edit Category Modal -->
    <div id="categoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full">
            <h3 class="text-2xl font-bold mb-4" id="categoryModalTitle">Add Category</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Category Name (English)</label>
                    <input type="text" id="modalCategoryName" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Home Services">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Emoji Icon</label>
                    <input type="text" id="modalCategoryIcon" class="w-full px-4 py-2 border rounded-lg text-center text-3xl" placeholder="ЁЯПа" maxlength="2">
                </div>
                <div class="flex gap-3">
                    <button onclick="saveCategoryModal()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-semibold">Save</button>
                    <button onclick="closeCategoryModal()" class="flex-1 bg-gray-400 text-white py-3 rounded-lg hover:bg-gray-500 font-semibold">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Subcategory Modal -->
    <div id="subcategoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full">
            <h3 class="text-2xl font-bold mb-4" id="subcategoryModalTitle">Add Subcategory</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Subcategory Name (English)</label>
                    <input type="text" id="modalSubcategoryName" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Plumbing">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Emoji Icon</label>
                    <input type="text" id="modalSubcategoryIcon" class="w-full px-4 py-2 border rounded-lg text-center text-3xl" placeholder="ЁЯФз" maxlength="2">
                </div>
                <div class="flex gap-3">
                    <button onclick="saveSubcategoryModal()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold">Save</button>
                    <button onclick="closeSubcategoryModal()" class="flex-1 bg-gray-400 text-white py-3 rounded-lg hover:bg-gray-500 font-semibold">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Service Modal -->
    <div id="serviceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full">
            <h3 class="text-2xl font-bold mb-4" id="serviceModalTitle">Add Service Type</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Service Name (English)</label>
                    <input type="text" id="modalServiceName" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Pipe Repair">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Emoji Icon</label>
                    <input type="text" id="modalServiceIcon" class="w-full px-4 py-2 border rounded-lg text-center text-3xl" placeholder="ЁЯФз" maxlength="2">
                </div>
                <div class="flex gap-3">
                    <button onclick="saveServiceModal()" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Save</button>
                    <button onclick="closeServiceModal()" class="flex-1 bg-gray-400 text-white py-3 rounded-lg hover:bg-gray-500 font-semibold">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA & INITIALIZATION ====================
        let currentLanguage = localStorage.getItem('language') || 'en';
        let providers = JSON.parse(localStorage.getItem('providers')) || [];
        let seekers = JSON.parse(localStorage.getItem('seekers')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let maps = {};
        
        // Selected browsing state
        let selectedCategoryId = null;
        let selectedSubcategoryIdx = null;
        let selectedServiceIdx = null;
        
        const ADMIN_PASSWORD = 'admin123';
        
        // Religion icons
        const religionIcons = {
            'Hindu': 'ЁЯХЙя╕П',
            'Muslim': 'тШкя╕П',
            'Christian': 'тЬЭя╕П',
            'Sikh': 'тШм',
            'Buddhist': 'тШ╕я╕П',
            'Jain': 'тШ╕я╕П'
        };
        
        // ==================== TRANSLATIONS ====================
        const translations = {
            // Navigation
            'home': { en: 'Home', hi: 'рд╣реЛрдо', bn: 'рж╣рзЛржо', gu: 'рк╣рлЛрко', mr: 'рд╣реЛрдо', kn: 'р▓ор▓ир│Ж' },
            'browse': { en: 'Browse', hi: 'рдмреНрд░рд╛рдЙрдЬрд╝', bn: 'ржмрзНрж░рж╛ржЙржЬ', gu: 'ркмрлНрк░рк╛ркЙркЭ', mr: 'рдмреНрд░рд╛рдЙрдЭ', kn: 'р▓мр│Нр▓░р│Мр▓╕р│Н' },
            'map': { en: 'Map', hi: 'рдореИрдк', bn: 'ржорж╛ржиржЪрж┐рждрзНрж░', gu: 'ркиркХрк╢рлЛ', mr: 'рдирдХрд╛рд╢рд╛', kn: 'р▓ир▓Хр│Нр▓╖р│Ж' },
            'registerProvider': { en: 'Register Provider', hi: 'рдкреНрд░рджрд╛рддрд╛ рдкрдВрдЬреАрдХрд░рдг', bn: 'ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзА ржирж┐ржмржирзНржзржи', gu: 'рккрлНрк░ркжрк╛ркдрк╛ ркирлЛркВркзркгрлА', mr: 'рдкреНрд░рджрд╛рддрд╛ рдиреЛрдВрджрдгреА', kn: 'р▓кр│Вр▓░р│Ир▓Хр│Жр▓жр▓╛р▓░ р▓ир│Лр▓Вр▓жр▓гр▓┐' },
            'registerSeeker': { en: 'Register Seeker', hi: 'рд╕рд╛рдзрдХ рдкрдВрдЬреАрдХрд░рдг', bn: 'ржЕржирзБрж╕ржирзНржзрж╛ржиржХрж╛рж░рзА ржирж┐ржмржирзНржзржи', gu: 'рк╢рлЛркзркирк╛рк░ ркирлЛркВркзркгрлА', mr: 'рд╢реЛрдзрдХ рдиреЛрдВрджрдгреА', kn: 'р▓╣р│Бр▓бр│Бр▓Хр│Бр▓╡р▓╡р▓░ р▓ир│Лр▓Вр▓жр▓гр▓┐' },
            'admin': { en: 'Admin', hi: 'рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ', bn: 'ржкрзНрж░рж╢рж╛рж╕ржХ', gu: 'рк╡рлНркпрк╡рк╕рлНркерк╛рккркХ', mr: 'рдкреНрд░рд╢рд╛рд╕рдХ', kn: 'р▓ир▓┐р▓░р│Нр▓╡р▓╛р▓╣р▓Х' },
            
            // Form fields
            'fullName': { en: 'Full Name *', hi: 'рдкреВрд░рд╛ рдирд╛рдо *', bn: 'рж╕ржорзНржкрзВрж░рзНржг ржирж╛ржо *', gu: 'рккрлВрк░рлБркВ ркирк╛рко *', mr: 'рд╕рдВрдкреВрд░реНрдг рдирд╛рд╡ *', kn: 'р▓кр│Вр▓░р│Нр▓г р▓╣р│Жр▓╕р▓░р│Б *' },
            'mobile': { en: 'Mobile Number *', hi: 'рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ *', bn: 'ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ *', gu: 'ркорлЛркмрк╛ркЗрк▓ ркиркВркмрк░ *', mr: 'рдореЛрдмрд╛рдИрд▓ рдирдВрдмрд░ *', kn: 'р▓ор│Кр▓мр│Ир▓▓р│Н р▓╕р▓Вр▓Цр│Нр▓пр│Ж *' },
            'category': { en: 'Category (Optional)', hi: 'рд╢реНрд░реЗрдгреА (рд╡реИрдХрд▓реНрдкрд┐рдХ)', bn: 'ржмрж┐ржнрж╛ржЧ (ржРржЪрзНржЫрж┐ржХ)', gu: 'ркХрлЗркЯрлЗркЧрк░рлА (рк╡рлИркХрк▓рлНрккрк┐ркХ)', mr: 'рд╢реНрд░реЗрдгреА (рдкрд░реНрдпрд╛рдпреА)', kn: 'р▓╡р▓░р│Нр▓Ч (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)' },
            'subcategory': { en: 'Subcategory (Optional)', hi: 'рдЙрдкрд╢реНрд░реЗрдгреА (рд╡реИрдХрд▓реНрдкрд┐рдХ)', bn: 'ржЙржкржмрж┐ржнрж╛ржЧ (ржРржЪрзНржЫрж┐ржХ)', gu: 'ркЙрккркХрлЗркЯрлЗркЧрк░рлА (рк╡рлИркХрк▓рлНрккрк┐ркХ)', mr: 'рдЙрдкрд╢реНрд░реЗрдгреА (рдкрд░реНрдпрд╛рдпреА)', kn: 'р▓Йр▓кр▓╡р▓░р│Нр▓Ч (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)' },
            'serviceType': { en: 'Service Type (Optional)', hi: 'рд╕реЗрд╡рд╛ рдкреНрд░рдХрд╛рд░ (рд╡реИрдХрд▓реНрдкрд┐рдХ)', bn: 'рж╕рзЗржмрж╛ ржкрзНрж░ржХрж╛рж░ (ржРржЪрзНржЫрж┐ржХ)', gu: 'рк╕рлЗрк╡рк╛ рккрлНрк░ркХрк╛рк░ (рк╡рлИркХрк▓рлНрккрк┐ркХ)', mr: 'рд╕реЗрд╡рд╛ рдкреНрд░рдХрд╛рд░ (рдкрд░реНрдпрд╛рдпреА)', kn: 'р▓╕р│Зр▓╡р│Ж р▓кр│Нр▓░р▓Хр▓╛р▓░ (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)' },
            'religion': { en: 'Religion *', hi: 'рдзрд░реНрдо *', bn: 'ржзрж░рзНржо *', gu: 'ркзрк░рлНрко *', mr: 'рдзрд░реНрдо *', kn: 'р▓зр▓░р│Нр▓о *' },
            'selectReligion': { en: 'Select Religion', hi: 'рдзрд░реНрдо рдЪреБрдиреЗрдВ', bn: 'ржзрж░рзНржо ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи', gu: 'ркзрк░рлНрко рккрк╕ркВркж ркХрк░рлЛ', mr: 'рдзрд░реНрдо рдирд┐рд╡рдбрд╛', kn: 'р▓зр▓░р│Нр▓о р▓Жр▓пр│Нр▓Хр│Жр▓ор▓╛р▓бр▓┐' },
            'experience': { en: 'Experience (years) *', hi: 'рдЕрдиреБрднрд╡ (рд╡рд░реНрд╖) *', bn: 'ржЕржнрж┐ржЬрзНржЮрждрж╛ (ржмржЫрж░) *', gu: 'ркЕркирлБркнрк╡ (рк╡рк░рлНрк╖) *', mr: 'рдЕрдиреБрднрд╡ (рд╡рд░реНрд╖реЗ) *', kn: 'р▓Ер▓ир│Бр▓нр▓╡ (р▓╡р▓░р│Нр▓╖р▓Чр▓│р│Б) *' },
            'rate': { en: 'Rate (тВ╣/hour) *', hi: 'рджрд░ (тВ╣/рдШрдВрдЯрд╛) *', bn: 'рж╣рж╛рж░ (тВ╣/ржШржирзНржЯрж╛) *', gu: 'ркжрк░ (тВ╣/ркХрк▓рк╛ркХ) *', mr: 'рджрд░ (тВ╣/рддрд╛рд╕) *', kn: 'р▓жр▓░ (тВ╣/р▓Чр▓Вр▓Яр│Ж) *' },
            'location': { en: 'Location/Address *', hi: 'рд╕реНрдерд╛рди/рдкрддрд╛ *', bn: 'ржЕржмрж╕рзНржерж╛ржи/ржарж┐ржХрж╛ржирж╛ *', gu: 'рк╕рлНркерк╛рки/рк╕рк░ркирк╛ркорлБркВ *', mr: 'рд╕реНрдерд╛рди/рдкрддреНрддрд╛ *', kn: 'р▓╕р│Нр▓ер▓│/р▓╡р▓┐р▓│р▓╛р▓╕ *' },
            'setLocation': { en: 'Set Your Location on Map', hi: 'рдорд╛рдирдЪрд┐рддреНрд░ рдкрд░ рдЕрдкрдирд╛ рд╕реНрдерд╛рди рд╕реЗрдЯ рдХрд░реЗрдВ', bn: 'ржорж╛ржиржЪрж┐рждрзНрж░рзЗ ржЖржкржирж╛рж░ ржЕржмрж╕рзНржерж╛ржи рж╕рзЗржЯ ржХрж░рзБржи', gu: 'ркиркХрк╢рк╛ рккрк░ ркдркорк╛рк░рлБркВ рк╕рлНркерк╛рки рк╕рлЗркЯ ркХрк░рлЛ', mr: 'рдирдХрд╛рд╢рд╛рд╡рд░ рддреБрдордЪреЗ рд╕реНрдерд╛рди рд╕реЗрдЯ рдХрд░рд╛', kn: 'р▓ир▓Хр│Нр▓╖р│Жр▓пр▓▓р│Нр▓▓р▓┐ р▓ир▓┐р▓ор│Нр▓о р▓╕р│Нр▓ер▓│р▓╡р▓ир│Нр▓ир│Б р▓╣р│Кр▓Вр▓жр▓┐р▓╕р▓┐' },
            'useMyLocation': { en: 'Use My Location', hi: 'рдореЗрд░рд╛ рд╕реНрдерд╛рди рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ', bn: 'ржЖржорж╛рж░ ржЕржмрж╕рзНржерж╛ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи', gu: 'ркорк╛рк░рлБркВ рк╕рлНркерк╛рки рк╡рк╛рккрк░рлЛ', mr: 'рдорд╛рдЭреЗ рд╕реНрдерд╛рди рд╡рд╛рдкрд░рд╛', kn: 'р▓ир▓ир│Нр▓и р▓╕р│Нр▓ер▓│ р▓мр▓│р▓╕р▓┐' },
            'registerNow': { en: 'Register Now', hi: 'рдЕрднреА рдкрдВрдЬреАрдХрд░рдг рдХрд░реЗрдВ', bn: 'ржПржЦржиржЗ ржирж┐ржмржирзНржзржи ржХрж░рзБржи', gu: 'рк╣ркоркгрк╛ркВ ркирлЛркВркзркгрлА ркХрк░рлЛ', mr: 'рдЖрддрд╛ рдиреЛрдВрджрдгреА рдХрд░рд╛', kn: 'р▓Ир▓Ч р▓ир│Лр▓Вр▓жр▓гр▓┐ р▓ор▓╛р▓бр▓┐' },
            
            // Headings
            'findProviders': { en: 'Find Verified Service Providers Near You', hi: 'рдЕрдкрдиреЗ рдкрд╛рд╕ рд╕рддреНрдпрд╛рдкрд┐рдд рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рдЦреЛрдЬреЗрдВ', bn: 'ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржпрж╛ржЪрж╛ржЗржХрзГржд рж╕рзЗржмрж╛ ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзА ржЦрзБржБржЬрзБржи', gu: 'ркдркорк╛рк░рлА ркиркЬрлАркХ ркЪркХрк╛рк╕рк╛ркпрлЗрк▓ рк╕рлЗрк╡рк╛ рккрлНрк░ркжрк╛ркдрк╛ркУ рк╢рлЛркзрлЛ', mr: 'рддреБрдордЪреНрдпрд╛ рдЬрд╡рд│ рд╕рддреНрдпрд╛рдкрд┐рдд рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддреЗ рд╢реЛрдзрд╛', kn: 'р▓ир▓┐р▓ор│Нр▓о р▓╕р▓ор│Ар▓кр▓жр▓▓р│Нр▓▓р▓┐ р▓кр▓░р▓┐р▓╢р│Ар▓▓р▓┐р▓д р▓╕р│Зр▓╡р▓╛ р▓кр│Вр▓░р│Ир▓Хр│Жр▓жр▓╛р▓░р▓░р▓ир│Нр▓ир│Б р▓╣р│Бр▓бр│Бр▓Хр▓┐' },
            'serviceCategories': { en: 'Service Categories', hi: 'рд╕реЗрд╡рд╛ рд╢реНрд░реЗрдгрд┐рдпрд╛рдБ', bn: 'рж╕рзЗржмрж╛ ржмрж┐ржнрж╛ржЧ', gu: 'рк╕рлЗрк╡рк╛ рк╢рлНрк░рлЗркгрлАркУ', mr: 'рд╕реЗрд╡рд╛ рд╢реНрд░реЗрдгреНрдпрд╛', kn: 'р▓╕р│Зр▓╡р▓╛ р▓╡р▓░р│Нр▓Чр▓Чр▓│р│Б' },
            'browseServices': { en: 'Browse Services', hi: 'рд╕реЗрд╡рд╛рдПрдВ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВ', bn: 'рж╕рзЗржмрж╛ ржмрзНрж░рж╛ржЙржЬ ржХрж░рзБржи', gu: 'рк╕рлЗрк╡рк╛ркУ ркмрлНрк░рк╛ркЙркЭ ркХрк░рлЛ', mr: 'рд╕реЗрд╡рд╛ рдмреНрд░рд╛рдЙрдЭ рдХрд░рд╛', kn: 'р▓╕р│Зр▓╡р│Жр▓Чр▓│р▓ир│Нр▓ир│Б р▓мр│Нр▓░р│Мр▓╕р│Н р▓ор▓╛р▓бр▓┐' },
            'becomeProvider': { en: 'Become a Provider', hi: 'рдкреНрд░рджрд╛рддрд╛ рдмрдиреЗрдВ', bn: 'ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзА рж╣ржи', gu: 'рккрлНрк░ркжрк╛ркдрк╛ ркмркирлЛ', mr: 'рдкреНрд░рджрд╛рддрд╛ рд╡реНрд╣рд╛', kn: 'р▓кр│Вр▓░р│Ир▓Хр│Жр▓жр▓╛р▓░р▓░р▓╛р▓Чр▓┐' },
            
            // Buttons
            'call': { en: 'ЁЯУЮ Call', hi: 'ЁЯУЮ рдХреЙрд▓ рдХрд░реЗрдВ', bn: 'ЁЯУЮ ржХрж▓ ржХрж░рзБржи', gu: 'ЁЯУЮ ркХрлЙрк▓ ркХрк░рлЛ', mr: 'ЁЯУЮ рдХреЙрд▓ рдХрд░рд╛', kn: 'ЁЯУЮ р▓Хр▓░р│Ж р▓ор▓╛р▓бр▓┐' },
            'directions': { en: 'ЁЯЧ║я╕П Directions', hi: 'ЁЯЧ║я╕П рджрд┐рд╢рд╛-рдирд┐рд░реНрджреЗрд╢', bn: 'ЁЯЧ║я╕П ржжрж┐ржХржирж┐рж░рзНржжрзЗрж╢', gu: 'ЁЯЧ║я╕П ркжрк┐рк╢рк╛ркУ', mr: 'ЁЯЧ║я╕П рджрд┐рд╢рд╛рдирд┐рд░реНрджреЗрд╢', kn: 'ЁЯЧ║я╕П р▓ир▓┐р▓░р│Нр▓жр│Зр▓╢р▓ир▓Чр▓│р│Б' },
            'backToHome': { en: 'тЖР Back to Home', hi: 'тЖР рд╣реЛрдо рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ', bn: 'тЖР рж╣рзЛржорзЗ ржлрж┐рж░рзЗ ржпрж╛ржи', gu: 'тЖР рк╣рлЛрко рккрк░ рккрк╛ркЫрк╛ ркЬрк╛ркУ', mr: 'тЖР рд╣реЛрдорд╡рд░ рдкрд░рдд рдЬрд╛', kn: 'тЖР р▓ор▓ир│Жр▓Чр│Ж р▓╣р▓┐р▓Вр▓др▓┐р▓░р│Бр▓Чр▓┐' },
            
            // Phase B: Sorting & Filtering
            'sortBy': { en: 'Sort By', hi: 'рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ', bn: 'рж╕рж╛ржЬрж╛ржи', gu: 'ркХрлНрк░ркоркмркжрлНркз ркХрк░рлЛ', mr: 'рдХреНрд░рдорд╡рд╛рд░реА рд▓рд╛рд╡рд╛', kn: 'р▓╡р▓┐р▓Вр▓Чр▓бр▓┐р▓╕р▓┐' },
            'filters': { en: 'ЁЯФН Filters', hi: 'ЁЯФН рдлрд╝рд┐рд▓реНрдЯрд░', bn: 'ЁЯФН ржлрж┐рж▓рзНржЯрж╛рж░', gu: 'ЁЯФН рклрк┐рк▓рлНркЯрк░', mr: 'ЁЯФН рдлрд┐рд▓реНрдЯрд░', kn: 'ЁЯФН р▓лр▓┐р▓▓р│Нр▓Яр▓░р│НтАМр▓Чр▓│р│Б' },
            'rating': { en: 'Rating (High to Low)', hi: 'рд░реЗрдЯрд┐рдВрдЧ (рдЙрдЪреНрдЪ рд╕реЗ рдирд┐рдореНрди)', bn: 'рж░рзЗржЯрж┐ржВ (ржЙржЪрзНржЪ ржерзЗржХрзЗ ржирж┐ржорзНржи)', gu: 'рк░рлЗркЯрк┐ркВркЧ (ркЙркЪрлНркЪркерлА ркирлАркЪрлБркВ)', mr: 'рд░реЗрдЯрд┐рдВрдЧ (рдЙрдЪреНрдЪ рддреЗ рдХрдореА)', kn: 'р▓░р│Зр▓Яр▓┐р▓Вр▓Чр│Н (р▓╣р│Жр▓Ър│Нр▓Ър│Б р▓░р▓┐р▓Вр▓ж р▓Хр▓бр▓┐р▓ор│Ж)' },
            'priceLowToHigh': { en: 'Price (Low to High)', hi: 'рдореВрд▓реНрдп (рдХрдо рд╕реЗ рдЕрдзрд┐рдХ)', bn: 'ржорзВрж▓рзНржп (ржХржо ржерзЗржХрзЗ ржмрзЗрж╢рж┐)', gu: 'ркХрк┐ркВркоркд (ркУркЫрлАркерлА рк╡ркзрк╛рк░рлЗ)', mr: 'рдХрд┐рдВрдордд (рдХрдореА рддреЗ рдЬрд╛рд╕реНрдд)', kn: 'р▓мр│Жр▓▓р│Ж (р▓Хр▓бр▓┐р▓ор│Ж р▓░р▓┐р▓Вр▓ж р▓╣р│Жр▓Ър│Нр▓Ър│Б)' },
            'distanceNearToFar': { en: 'Distance (Near to Far)', hi: 'рджреВрд░реА (рдкрд╛рд╕ рд╕реЗ рджреВрд░)', bn: 'ржжрзВрж░рждрзНржм (ржХрж╛ржЫ ржерзЗржХрзЗ ржжрзВрж░)', gu: 'ркЕркВркдрк░ (ркиркЬрлАркХркерлА ркжрлВрк░)', mr: 'рдЕрдВрддрд░ (рдЬрд╡рд│реВрди рджреВрд░)', kn: 'р▓Ер▓Вр▓др▓░ (р▓╕р▓ор│Ар▓кр▓жр▓┐р▓Вр▓ж р▓жр│Вр▓░)' },
            'experienceHighToLow': { en: 'Experience (High to Low)', hi: 'рдЕрдиреБрднрд╡ (рдЕрдзрд┐рдХ рд╕реЗ рдХрдо)', bn: 'ржЕржнрж┐ржЬрзНржЮрждрж╛ (ржмрзЗрж╢рж┐ ржерзЗржХрзЗ ржХржо)', gu: 'ркЕркирлБркнрк╡ (рк╡ркзрлБркерлА ркУркЫрлБркВ)', mr: 'рдЕрдиреБрднрд╡ (рдЬрд╛рд╕реНрдд рддреЗ рдХрдореА)', kn: 'р▓Ер▓ир│Бр▓нр▓╡ (р▓╣р│Жр▓Ър│Нр▓Ър│Б р▓░р▓┐р▓Вр▓ж р▓Хр▓бр▓┐р▓ор│Ж)' },
            'applyFilters': { en: 'Apply Filters', hi: 'рдлрд╝рд┐рд▓реНрдЯрд░ рд▓рд╛рдЧреВ рдХрд░реЗрдВ', bn: 'ржлрж┐рж▓рзНржЯрж╛рж░ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржи', gu: 'рклрк┐рк▓рлНркЯрк░ рк▓рк╛ркЧрлБ ркХрк░рлЛ', mr: 'рдлрд┐рд▓реНрдЯрд░ рд▓рд╛рдЧреВ рдХрд░рд╛', kn: 'р▓лр▓┐р▓▓р│Нр▓Яр▓░р│НтАМр▓Чр▓│р▓ир│Нр▓ир│Б р▓Ер▓ир│Нр▓╡р▓пр▓┐р▓╕р▓┐' },
            'clearFilters': { en: 'Clear All', hi: 'рд╕рднреА рд╕рд╛рдлрд╝ рдХрд░реЗрдВ', bn: 'рж╕ржм рж╕рж╛ржл ржХрж░рзБржи', gu: 'ркмркзрлБркВ рк╕рк╛ркл ркХрк░рлЛ', mr: 'рд╕рд░реНрд╡ рд╕рд╛рдл рдХрд░рд╛', kn: 'р▓Ор▓▓р│Нр▓▓р▓╡р▓ир│Нр▓ир│В р▓др│Жр▓░р▓╡р│Бр▓Чр│Кр▓│р▓┐р▓╕р▓┐' },
            'languageFilter': { en: 'Language', hi: 'рднрд╛рд╖рд╛', bn: 'ржнрж╛рж╖рж╛', gu: 'ркнрк╛рк╖рк╛', mr: 'рднрд╛рд╖рд╛', kn: 'р▓нр▓╛р▓╖р│Ж' },
            'religionFilter': { en: 'Religion', hi: 'рдзрд░реНрдо', bn: 'ржзрж░рзНржо', gu: 'ркзрк░рлНрко', mr: 'рдзрд░реНрдо', kn: 'р▓зр▓░р│Нр▓о' },
            'priceRange': { en: 'Price Range (тВ╣/hr)', hi: 'рдореВрд▓реНрдп рд╕реАрдорд╛ (тВ╣/рдШрдВрдЯрд╛)', bn: 'ржорзВрж▓рзНржп рж╕рзАржорж╛ (тВ╣/ржШржирзНржЯрж╛)', gu: 'ркХрк┐ркВркоркд рк╢рлНрк░рлЗркгрлА (тВ╣/ркХрк▓рк╛ркХ)', mr: 'рдХрд┐рдВрдордд рд╢реНрд░реЗрдгреА (тВ╣/рддрд╛рд╕)', kn: 'р▓мр│Жр▓▓р│Ж р▓╡р│Нр▓пр▓╛р▓кр│Нр▓др▓┐ (тВ╣/р▓Чр▓Вр▓Яр│Ж)' },
            'maxDistanceFilter': { en: 'Maximum Distance', hi: 'рдЕрдзрд┐рдХрддрдо рджреВрд░реА', bn: 'рж╕рж░рзНржмрзЛржЪрзНржЪ ржжрзВрж░рждрзНржм', gu: 'ркорк╣ркдрлНркдрко ркЕркВркдрк░', mr: 'рдХрдорд╛рд▓ рдЕрдВрддрд░', kn: 'р▓Чр▓░р▓┐р▓╖р│Нр▓а р▓Ер▓Вр▓др▓░' },
            'anyLanguage': { en: 'Any Language', hi: 'рдХреЛрдИ рднреА рднрд╛рд╖рд╛', bn: 'ржпрзЗржХрзЛржирзЛ ржнрж╛рж╖рж╛', gu: 'ркХрлЛркИрккркг ркнрк╛рк╖рк╛', mr: 'рдХреЛрдгрддреАрд╣реА рднрд╛рд╖рд╛', kn: 'р▓пр▓╛р▓╡р│Бр▓жр│З р▓нр▓╛р▓╖р│Ж' },
            'anyReligion': { en: 'Any Religion', hi: 'рдХреЛрдИ рднреА рдзрд░реНрдо', bn: 'ржпрзЗржХрзЛржирзЛ ржзрж░рзНржо', gu: 'ркХрлЛркИрккркг ркзрк░рлНрко', mr: 'рдХреЛрдгрддрд╛рд╣реА рдзрд░реНрдо', kn: 'р▓пр▓╛р▓╡р│Бр▓жр│З р▓зр▓░р│Нр▓о' },
            'providerLanguage': { en: 'Provider Language *', hi: 'рдкреНрд░рджрд╛рддрд╛ рднрд╛рд╖рд╛ *', bn: 'ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзА ржнрж╛рж╖рж╛ *', gu: 'рккрлНрк░ркжрк╛ркдрк╛ ркнрк╛рк╖рк╛ *', mr: 'рдкреНрд░рджрд╛рддрд╛ рднрд╛рд╖рд╛ *', kn: 'р▓кр│Вр▓░р│Ир▓Хр│Жр▓жр▓╛р▓░ р▓нр▓╛р▓╖р│Ж *' },
            'workingHours': { en: 'Working Hours *', hi: 'рдХрд╛рд░реНрдп рд╕рдордп *', bn: 'ржХрж╛ржЬрзЗрж░ рж╕ржоржпрж╝ *', gu: 'ркХрк╛ркоркирк╛ ркХрк▓рк╛ркХрлЛ *', mr: 'рдХрд╛рдорд╛рдЪреЗ рддрд╛рд╕ *', kn: 'р▓Хр│Жр▓▓р▓╕р▓ж р▓Чр▓Вр▓Яр│Жр▓Чр▓│р│Б *' },
            'serviceArea': { en: 'Service Area *', hi: 'рд╕реЗрд╡рд╛ рдХреНрд╖реЗрддреНрд░ *', bn: 'рж╕рзЗржмрж╛ ржПрж▓рж╛ржХрж╛ *', gu: 'рк╕рлЗрк╡рк╛ рк╡рк┐рк╕рлНркдрк╛рк░ *', mr: 'рд╕реЗрд╡рд╛ рдХреНрд╖реЗрддреНрд░ *', kn: 'р▓╕р│Зр▓╡р▓╛ р▓кр│Нр▓░р▓жр│Зр▓╢ *' },
            'monFri': { en: 'Mon-Fri (9 AM - 6 PM)', hi: 'рд╕реЛрдо-рд╢реБрдХреНрд░ (9 AM - 6 PM)', bn: 'рж╕рзЛржо-рж╢рзБржХрзНрж░ (9 AM - 6 PM)', gu: 'рк╕рлЛрко-рк╢рлБркХрлНрк░ (9 AM - 6 PM)', mr: 'рд╕реЛрдо-рд╢реБрдХреНрд░ (9 AM - 6 PM)', kn: 'р▓╕р│Лр▓о-р▓╢р│Бр▓Хр│Нр▓░ (9 AM - 6 PM)' },
            'weekends': { en: 'Weekends Only', hi: 'рдХреЗрд╡рд▓ рд╕рдкреНрддрд╛рд╣рд╛рдВрдд', bn: 'рж╢рзБржзрзБ рж╕ржкрзНрждрж╛рж╣рж╛ржирзНрждрзЗ', gu: 'ркорк╛ркдрлНрк░ рк╕рккрлНркдрк╛рк╣рк╛ркВркд', mr: 'рдлрдХреНрдд рдЖрдард╡рдбреНрдпрд╛рдЪрд╛ рд╢реЗрд╡рдЯ', kn: 'р▓╡р▓╛р▓░р▓╛р▓Вр▓др│Нр▓пр▓Чр▓│р│Б р▓ор▓╛р▓др│Нр▓░' },
            'allDays': { en: 'All Days (7 days/week)', hi: 'рд╕рднреА рджрд┐рди (7 рджрд┐рди/рд╕рдкреНрддрд╛рд╣)', bn: 'рж╕ржм ржжрж┐ржи (7 ржжрж┐ржи/рж╕ржкрзНрждрж╛рж╣)', gu: 'ркмркзрк╛ ркжрк┐рк╡рк╕рлЛ (7 ркжрк┐рк╡рк╕/ркЕркарк╡рк╛ркбрк┐ркпрлБркВ)', mr: 'рд╕рд░реНрд╡ рджрд┐рд╡рд╕ (7 рджрд┐рд╡рд╕/рдЖрдард╡рдбрд╛)', kn: 'р▓Ор▓▓р│Нр▓▓р▓╛ р▓жр▓┐р▓ир▓Чр▓│р│Б (7 р▓жр▓┐р▓ир▓Чр▓│р│Б/р▓╡р▓╛р▓░)' },
            'available24x7': { en: '24├Ч7 Available', hi: '24├Ч7 рдЙрдкрд▓рдмреНрдз', bn: '24├Ч7 ржЙржкрж▓ржмрзНржз', gu: '24├Ч7 ркЙрккрк▓ркмрлНркз', mr: '24├Ч7 рдЙрдкрд▓рдмреНрдз', kn: '24├Ч7 р▓▓р▓нр│Нр▓пр▓╡р▓┐р▓жр│Ж' },
            'within10km': { en: 'Within 10 km', hi: '10 рдХрд┐рдореА рдХреЗ рднреАрддрд░', bn: '10 ржХрж┐ржорж┐рж░ ржоржзрзНржпрзЗ', gu: '10 ркХрк┐ркорлАркирлА ркЕркВркжрк░', mr: '10 рдХрд┐рдореАрдЪреНрдпрд╛ рдЖрдд', kn: '10 р▓Хр▓┐р▓ор│А р▓Тр▓│р▓Чр│Ж' },
            'withinCity': { en: 'Within City', hi: 'рд╢рд╣рд░ рдХреЗ рднреАрддрд░', bn: 'рж╢рж╣рж░рзЗрж░ ржоржзрзНржпрзЗ', gu: 'рк╢рк╣рлЗрк░ркирлА ркЕркВркжрк░', mr: 'рд╢рд╣рд░рд╛рдЪреНрдпрд╛ рдЖрдд', kn: 'р▓ир▓Чр▓░р▓жр│Кр▓│р▓Чр│Ж' },
            'showingResults': { en: 'Showing {count} providers', hi: '{count} рдкреНрд░рджрд╛рддрд╛ рджрд┐рдЦрд╛ рд░рд╣реЗ рд╣реИрдВ', bn: '{count} ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзА ржжрзЗржЦрж╛ржЪрзНржЫрзЗ', gu: '{count} рккрлНрк░ркжрк╛ркдрк╛ркУ ркмркдрк╛рк╡рлА рк░рк╣рлНркпрк╛ ркЫрлАркП', mr: '{count} рдкреНрд░рджрд╛рддреЗ рджрд╛рдЦрд╡рдд рдЖрд╣реЗ', kn: '{count} р▓кр│Вр▓░р│Ир▓Хр│Жр▓жр▓╛р▓░р▓░р▓ир│Нр▓ир│Б р▓др│Лр▓░р▓┐р▓╕р▓▓р▓╛р▓Чр│Бр▓др│Нр▓др▓┐р▓жр│Ж' },
            
            // Phase C: Voice Commands
            'voiceSearch': { en: 'ЁЯОд Voice Search', hi: 'ЁЯОд рдзреНрд╡рдирд┐ рдЦреЛрдЬ', bn: 'ЁЯОд ржнржпрж╝рзЗрж╕ рж╕рж╛рж░рзНржЪ', gu: 'ЁЯОд рк╡рлЙркЗрк╕ рк╕рк░рлНркЪ', mr: 'ЁЯОд рд╡реНрд╣реЙрдЗрд╕ рд╢реЛрдз', kn: 'ЁЯОд р▓зр│Нр▓╡р▓ир▓┐ р▓╣р│Бр▓бр│Бр▓Хр▓╛р▓Я' },
            'listening': { en: 'Listening...', hi: 'рд╕реБрди рд░рд╣реЗ рд╣реИрдВ...', bn: 'рж╢рзБржиржЫрж┐...', gu: 'рк╕рк╛ркВркнрк│рлА рк░рк╣рлНркпрк╛ ркЫрлАркП...', mr: 'рдРрдХрдд рдЖрд╣реЗ...', kn: 'р▓Жр▓▓р▓┐р▓╕р│Бр▓др│Нр▓др▓┐р▓жр│Ж...' },
            'speak': { en: 'Speak now', hi: 'рдЕрднреА рдмреЛрд▓реЗрдВ', bn: 'ржПржЦржи ржмрж▓рзБржи', gu: 'рк╣ркоркгрк╛ркВ ркмрлЛрк▓рлЛ', mr: 'рдЖрддрд╛ рдмреЛрд▓рд╛', kn: 'р▓Ир▓Ч р▓ор▓╛р▓др▓ир▓╛р▓бр▓┐' },
            'voiceSearchFor': { en: 'Say: "Find a plumber" or "Show electricians"', hi: 'рдХрд╣реЗрдВ: "рдкреНрд▓рдВрдмрд░ рдЦреЛрдЬреЗрдВ" рдпрд╛ "рдЗрд▓реЗрдХреНрдЯреНрд░реАрд╢рд┐рдпрди рджрд┐рдЦрд╛рдПрдВ"', bn: 'ржмрж▓рзБржи: "ржкрзНрж▓рж╛ржорзНржмрж╛рж░ ржЦрзБржБржЬрзБржи" ржмрж╛ "ржЗрж▓рзЗржХржЯрзНрж░рж┐рж╢рж┐ржпрж╝рж╛ржи ржжрзЗржЦрж╛ржи"', gu: 'ркХрк╣рлЛ: "рккрлНрк▓ркорлНркмрк░ рк╢рлЛркзрлЛ" ркЕркерк╡рк╛ "ркЗрк▓рлЗркХрлНркЯрлНрк░рк┐рк╢рк┐ркпрки ркмркдрк╛рк╡рлЛ"', mr: 'рдореНрд╣рдгрд╛: "рдкреНрд▓рдВрдмрд░ рд╢реЛрдзрд╛" рдХрд┐рдВрд╡рд╛ "рдЗрд▓реЗрдХреНрдЯреНрд░рд┐рд╢рд┐рдпрди рджрд╛рдЦрд╡рд╛"', kn: 'р▓╣р│Зр▓│р▓┐: "р▓кр│Нр▓▓р▓Вр▓мр▓░р│Н р▓╣р│Бр▓бр│Бр▓Хр▓┐" р▓Ер▓ер▓╡р▓╛ "р▓Ор▓▓р│Жр▓Хр│Нр▓Яр│Нр▓░р▓┐р▓╖р▓┐р▓пр▓ир│Н р▓др│Лр▓░р▓┐р▓╕р▓┐"' },
            'noSpeechDetected': { en: 'No speech detected. Please try again.', hi: 'рдХреЛрдИ рдЖрд╡рд╛рдЬрд╝ рдирд╣реАрдВ рд╕реБрдиреАред рдХреГрдкрдпрд╛ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред', bn: 'ржХрзЛржирзЛ ржХржерж╛ рж╢рзЛржирж╛ ржпрж╛ржпрж╝ржирж┐ред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред', gu: 'ркХрлЛркИ рк╡рк╛ркгрлА рк╕рк╛ркВркнрк│рк╛ркИ ркирк╣рлАркВ. рклрк░рлА рккрлНрк░ркпрк╛рк╕ ркХрк░рлЛ.', mr: 'рдЖрд╡рд╛рдЬ рдРрдХреВ рдЖрд▓рд╛ рдирд╛рд╣реА. рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.', kn: 'р▓пр▓╛р▓╡р│Бр▓жр│З р▓нр▓╛р▓╖р▓г р▓кр▓др│Нр▓др│Жр▓пр▓╛р▓Чр▓┐р▓▓р│Нр▓▓. р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓ор▓др│Нр▓др│Ж р▓кр│Нр▓░р▓пр▓др│Нр▓ир▓┐р▓╕р▓┐.' },
            'searchingFor': { en: 'Searching for {service}...', hi: '{service} рдЦреЛрдЬ рд░рд╣реЗ рд╣реИрдВ...', bn: '{service} ржЦрзБржБржЬржЫрж┐...', gu: '{service} рк╢рлЛркзрлА рк░рк╣рлНркпрк╛ ркЫрлАркП...', mr: '{service} рд╢реЛрдзрдд рдЖрд╣реЗ...', kn: '{service} р▓╣р│Бр▓бр│Бр▓Хр│Бр▓др│Нр▓др▓┐р▓жр│Ж...' }
        };
        
        // Translation helper function with variable substitution
        function t(key, vars = {}) {
            let text = translations[key] ? (translations[key][currentLanguage] || translations[key].en) : key;
            // Replace variables like {count}
            Object.keys(vars).forEach(varKey => {
                text = text.replace(`{${varKey}}`, vars[varKey]);
            });
            return text;
        }
        
        
        // Default categories
        let categories = JSON.parse(localStorage.getItem('categories')) || [
            {
                id: 'cat1',
                name: { en: 'Home Services' },
                icon: 'ЁЯПа',
                subcategories: [
                    {
                        name: { en: 'Plumbing' },
                        icon: 'ЁЯФз',
                        subsubcategories: [
                            { name: { en: 'Pipe Repair' }, icon: 'ЁЯФз' },
                            { name: { en: 'Tank Installation' }, icon: 'ЁЯТз' },
                            { name: { en: 'Bathroom Fitting' }, icon: 'ЁЯЪ┐' }
                        ]
                    },
                    {
                        name: { en: 'Electrical' },
                        icon: 'тЪб',
                        subsubcategories: [
                            { name: { en: 'Wiring' }, icon: 'ЁЯФМ' },
                            { name: { en: 'Appliance Repair' }, icon: 'ЁЯФз' }
                        ]
                    }
                ]
            }
        ];
        
        // ==================== UTILITY FUNCTIONS ====================
        function getTranslated(obj, defaultText = '') {
            if (!obj) return defaultText;
            if (typeof obj === 'string') return obj;
            return obj[currentLanguage] || obj.en || defaultText;
        }
        
        // Haversine formula for distance calculation
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // Distance in km
        }
        
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;
            
            let stars = 'тнР'.repeat(fullStars);
            if (halfStar) stars += 'тнР';
            stars += 'тШЖ'.repeat(emptyStars);
            return stars;
        }
        
        // ==================== LANGUAGE ====================
        function selectLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            document.getElementById('languageModal').classList.add('hidden');
            
            // Update language button
            const langNames = {
                'en': 'EN',
                'hi': 'рд╣рд┐рдВ',
                'bn': 'ржмрж╛ржВ',
                'gu': 'ркЧрлБркЬ',
                'mr': 'рдорд░рд╛',
                'kn': 'р▓Хр▓ир│Нр▓и'
            };
            document.getElementById('currentLang').textContent = langNames[lang] || 'EN';
            
            // Update ALL UI text
            updateAllUIText();
            
            // Reload content in new language (categories)
            loadHomeCategories();
            loadBrowseCategories();
            updateProviderCategorySelects();
            
            console.log('Language changed to:', lang);
        }
        
        function initializeTranslations() {
            // Add data-i18n attributes to elements that need translation
            // This runs once on page load to mark translatable elements
            
            // Already done in HTML: Navigation buttons
            
            // Mark headings
            document.querySelectorAll('h1, h2, h3').forEach(heading => {
                const text = heading.textContent.trim();
                if (text.includes('Find') && text.includes('Perfect')) heading.setAttribute('data-i18n', 'findProviders');
                if (text === 'Service Categories') heading.setAttribute('data-i18n', 'serviceCategories');
                if (text.includes('Register as Service Provider')) heading.setAttribute('data-i18n', 'registerAsProvider');
                if (text.includes('Register as Service Seeker')) heading.setAttribute('data-i18n', 'registerAsSeeker');
                if (text === '1я╕ПтГг Select Category') heading.setAttribute('data-i18n', 'selectCategory');
                if (text === '2я╕ПтГг Select Subcategory') heading.setAttribute('data-i18n', 'selectSubcategory');
                if (text === '3я╕ПтГг Select Service Type') heading.setAttribute('data-i18n', 'selectService');
                if (text === 'Providers Near You') heading.setAttribute('data-i18n', 'providersNearYou');
                if (text.includes('Find Service Providers Near You')) heading.setAttribute('data-i18n', 'findServiceProviders');
            });
            
            // Mark form labels
            document.querySelectorAll('label').forEach(label => {
                const text = label.textContent.trim();
                if (text === 'Full Name *') label.setAttribute('data-i18n', 'fullName');
                if (text === 'Mobile Number *') label.setAttribute('data-i18n', 'mobile');
                if (text === 'Category (Optional)') label.setAttribute('data-i18n', 'category');
                if (text === 'Subcategory (Optional)') label.setAttribute('data-i18n', 'subcategory');
                if (text === 'Service Type (Optional)') label.setAttribute('data-i18n', 'serviceType');
                if (text === 'Religion *') label.setAttribute('data-i18n', 'religion');
                if (text === 'Experience (years) *') label.setAttribute('data-i18n', 'experience');
                if (text.includes('Rate') && text.includes('*')) label.setAttribute('data-i18n', 'rate');
                if (text === 'Location/Address *') label.setAttribute('data-i18n', 'location');
                if (text === 'Set Your Location on Map') label.setAttribute('data-i18n', 'setLocation');
            });
            
            // Mark buttons
            document.querySelectorAll('button').forEach(btn => {
                const text = btn.textContent.trim();
                if (text.includes('Use My Location')) btn.setAttribute('data-i18n', 'useMyLocation');
                if (text === 'Register Now') btn.setAttribute('data-i18n', 'registerNow');
                if (text === 'Browse Services') btn.setAttribute('data-i18n', 'browseServices');
                if (text === 'Become a Provider') btn.setAttribute('data-i18n', 'becomeProvider');
                if (text.includes('Back to Home')) btn.setAttribute('data-i18n', 'backToHome');
            });
            
            console.log('Translation attributes initialized');
        }
        
        function updateAllUIText() {
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = t(key);
            });
            
            // Update Select Religion dropdown
            const religionSelects = document.querySelectorAll('#providerReligion, #seekerReligion');
            religionSelects.forEach(select => {
                if (select && select.options[0]) {
                    select.options[0].text = t('selectReligion');
                }
            });
            
            console.log('UI text updated to language:', currentLanguage);
        }
        
        function changeLang() {
            document.getElementById('languageModal').classList.remove('hidden');
        }
        
        // ==================== NAVIGATION ====================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            document.getElementById('page-' + pageName).classList.remove('hidden');
            
            if (pageName === 'home') {
                loadHomeCategories();
            } else if (pageName === 'browse') {
                loadBrowseCategories();
            } else if (pageName === 'map') {
                setTimeout(initMainMap, 100);
            } else if (pageName === 'register') {
                setTimeout(initRegisterMap, 100);
            } else if (pageName === 'seeker') {
                setTimeout(initSeekerMap, 100);
            }
        }
        
        // ==================== BROWSE PAGE WITH GRID VIEW ====================
        function loadBrowseCategories() {
            const grid = document.getElementById('browseCategoriesGrid');
            grid.innerHTML = categories.map(cat => `
                <div class="category-card bg-white p-6 rounded-xl shadow-md text-center" onclick="selectCategory('${cat.id}')">
                    <div class="text-5xl mb-3">${cat.icon}</div>
                    <div class="font-bold text-gray-800">${getTranslated(cat.name)}</div>
                </div>
            `).join('');
            
            // Reset selection
            document.getElementById('subcategorySection').classList.add('hidden');
            document.getElementById('serviceSection').classList.add('hidden');
            document.getElementById('providersSection').classList.add('hidden');
        }
        
        function selectCategory(catId) {
            selectedCategoryId = catId;
            selectedSubcategoryIdx = null;
            selectedServiceIdx = null;
            
            const category = categories.find(c => c.id === catId);
            if (!category || !category.subcategories) return;
            
            // Update UI - highlight selected
            document.querySelectorAll('#browseCategoriesGrid .category-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Show subcategories
            const grid = document.getElementById('browseSubcategoriesGrid');
            grid.innerHTML = category.subcategories.map((sub, idx) => `
                <div class="category-card bg-white p-6 rounded-xl shadow-md text-center" onclick="selectSubcategory(${idx})">
                    <div class="text-4xl mb-3">${sub.icon}</div>
                    <div class="font-bold text-gray-800">${getTranslated(sub.name)}</div>
                </div>
            `).join('');
            
            document.getElementById('subcategorySection').classList.remove('hidden');
            document.getElementById('serviceSection').classList.add('hidden');
            document.getElementById('providersSection').classList.add('hidden');
        }
        
        function selectSubcategory(subIdx) {
            selectedSubcategoryIdx = subIdx;
            selectedServiceIdx = null;
            
            const category = categories.find(c => c.id === selectedCategoryId);
            const subcategory = category.subcategories[subIdx];
            
            if (!subcategory.subsubcategories) return;
            
            // Update UI
            document.querySelectorAll('#browseSubcategoriesGrid .category-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Show services
            const grid = document.getElementById('browseServicesGrid');
            grid.innerHTML = subcategory.subsubcategories.map((service, idx) => `
                <div class="category-card bg-white p-6 rounded-xl shadow-md text-center" onclick="selectService(${idx})">
                    <div class="text-4xl mb-3">${service.icon}</div>
                    <div class="font-bold text-gray-800">${getTranslated(service.name)}</div>
                </div>
            `).join('');
            
            document.getElementById('serviceSection').classList.remove('hidden');
            document.getElementById('providersSection').classList.add('hidden');
        }
        
        function selectService(serviceIdx) {
            selectedServiceIdx = serviceIdx;
            
            // Update UI
            document.querySelectorAll('#browseServicesGrid .category-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Load and display providers
            applySortAndFilter();
        }
        
        // ==================== PHASE B: SORT & FILTER FUNCTIONS ====================
        function toggleFilters() {
            const panel = document.getElementById('filterPanel');
            panel.classList.toggle('hidden');
        }
        
        function clearFilters() {
            document.getElementById('filterLanguage').value = '';
            document.getElementById('filterReligion').value = '';
            document.getElementById('filterPriceMin').value = '0';
            document.getElementById('filterPriceMax').value = '2000';
            document.getElementById('filterDistance').value = '999';
            document.getElementById('sortSelect').value = 'rating';
            applySortAndFilter();
        }
        
        function applySortAndFilter() {
            // Get current filtered providers (by service)
            const category = categories.find(c => c.id === selectedCategoryId);
            if (!category) {
                console.log('тЭМ Category not found:', selectedCategoryId);
                return;
            }
            
            const subcategory = category.subcategories[selectedSubcategoryIdx];
            if (!subcategory) {
                console.log('тЭМ Subcategory not found at index:', selectedSubcategoryIdx);
                return;
            }
            
            const service = subcategory.subsubcategories[selectedServiceIdx];
            if (!service) {
                console.log('тЭМ Service not found at index:', selectedServiceIdx);
                return;
            }
            
            const serviceNameEnglish = service.name.en || service.name;
            console.log('ЁЯФН Looking for providers with service:', serviceNameEnglish);
            console.log('ЁЯУЛ Target indices - Category:', selectedCategoryId, 'Sub:', selectedSubcategoryIdx, 'Service:', selectedServiceIdx);
            console.log('ЁЯУЛ Total providers in system:', providers.length);
            
            // Start with service filter - BACKWARD COMPATIBLE
            let filteredProviders = providers.filter(p => {
                // NEW: Exact match for providers with service name
                const exactMatch = p.service === serviceNameEnglish;
                
                // BACKWARD COMPATIBLE: For old providers without service field or with "undefined"
                // Check if they match by category/subcategory/service indices
                const hasValidService = p.service && p.service !== 'undefined' && p.service !== 'General Service Provider';
                const backwardCompatible = !hasValidService && 
                                          p.categoryId === selectedCategoryId && 
                                          p.subcategoryIdx == selectedSubcategoryIdx &&
                                          p.subsubcategoryIdx == selectedServiceIdx;
                
                const matchesService = exactMatch || backwardCompatible;
                const isActive = (!p.status || p.status === 'active');
                
                console.log('  Provider:', p.name);
                console.log('    Service:', p.service, '| CategoryId:', p.categoryId, '| SubIdx:', p.subcategoryIdx, '| ServiceIdx:', p.subsubcategoryIdx);
                console.log('    ExactMatch:', exactMatch, '| BackwardMatch:', backwardCompatible, '| FinalMatch:', matchesService, '| Active:', isActive);
                
                return matchesService && isActive;
            });
            
            console.log('тЬЕ Providers matching service:', filteredProviders.length);
            
            // Apply Phase B filters
            const filterLang = document.getElementById('filterLanguage').value;
            const filterRel = document.getElementById('filterReligion').value;
            const filterPriceMin = parseInt(document.getElementById('filterPriceMin').value) || 0;
            const filterPriceMax = parseInt(document.getElementById('filterPriceMax').value) || 99999;
            const filterDist = parseFloat(document.getElementById('filterDistance').value) || 999;
            
            filteredProviders = filteredProviders.filter(p => {
                // Language filter
                if (filterLang && p.language && p.language !== filterLang) return false;
                
                // Religion filter
                if (filterRel && p.religion !== filterRel) return false;
                
                // Price filter
                if (p.rate < filterPriceMin || p.rate > filterPriceMax) return false;
                
                // Distance filter (calculate if needed)
                if (currentUser && currentUser.lat && currentUser.lng && p.lat && p.lng) {
                    const dist = calculateDistance(currentUser.lat, currentUser.lng, p.lat, p.lng);
                    p.distance = dist;
                    if (dist > filterDist) return false;
                } else {
                    p.distance = 9999;
                }
                
                return true;
            });
            
            // Apply sorting
            const sortBy = document.getElementById('sortSelect').value;
            
            filteredProviders.sort((a, b) => {
                switch(sortBy) {
                    case 'rating':
                        return (b.rating || 0) - (a.rating || 0);
                    case 'price':
                        return (a.rate || 0) - (b.rate || 0);
                    case 'distance':
                        return (a.distance || 9999) - (b.distance || 9999);
                    case 'experience':
                        return (b.experience || 0) - (a.experience || 0);
                    default:
                        return 0;
                }
            });
            
            // Update results count
            document.getElementById('resultsCount').textContent = t('showingResults', { count: filteredProviders.length });
            
            // Render providers
            renderProviders(filteredProviders);
        }
        
        function renderProviders(filteredProviders) {
            if (filteredProviders.length === 0) {
                document.getElementById('providersGridNew').innerHTML = `
                    <div class="text-center py-12 bg-white rounded-xl shadow">
                        <p class="text-xl text-gray-500">No providers found matching your filters</p>
                        <p class="text-gray-400 mt-2">Try adjusting your filters</p>
                    </div>
                `;
                document.getElementById('providersSection').classList.remove('hidden');
                return;
            }
            
            // Render provider cards (existing code from loadProviders)
            const grid = document.getElementById('providersGridNew');
            grid.innerHTML = filteredProviders.map(p => `
                <div class="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${p.name}</h3>
                            <div class="text-orange-600 font-medium">${p.service}</div>
                            ${p.language ? `<div class="text-sm text-gray-600 mt-1">ЁЯЧгя╕П ${p.language}</div>` : ''}
                            ${p.workingHours ? `<div class="text-sm text-green-600 mt-1">${getWorkingHoursLabel(p.workingHours)}</div>` : ''}
                        </div>
                        <div class="text-right">
                            <div class="star-rating text-xl">${generateStars(p.rating || 4.0)}</div>
                            <div class="text-sm text-gray-600">${(p.rating || 4.0).toFixed(1)}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 text-sm mb-4">
                        <div class="flex items-center gap-2">
                            <span>ЁЯУН</span>
                            <span class="text-gray-700">${p.distance < 100 ? p.distance.toFixed(1) + ' km' : p.location}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span>ЁЯХР</span>
                            <span class="text-gray-700">${p.experience} ${currentLanguage === 'en' ? 'years' : currentLanguage === 'hi' ? 'рд╡рд░реНрд╖' : currentLanguage === 'bn' ? 'ржмржЫрж░' : currentLanguage === 'gu' ? 'рк╡рк░рлНрк╖' : currentLanguage === 'mr' ? 'рд╡рд░реНрд╖реЗ' : 'р▓╡р▓░р│Нр▓╖р▓Чр▓│р│Б'}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span>${religionIcons[p.religion] || 'ЁЯЩП'}</span>
                            <span class="text-gray-700">${p.religion}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span>ЁЯТ░</span>
                            <span class="text-gray-700 font-semibold">тВ╣${p.rate}/${currentLanguage === 'en' ? 'hr' : currentLanguage === 'hi' ? 'рдШрдВрдЯрд╛' : currentLanguage === 'bn' ? 'ржШржирзНржЯрж╛' : currentLanguage === 'gu' ? 'ркХрк▓рк╛ркХ' : currentLanguage === 'mr' ? 'рддрд╛рд╕' : 'р▓Чр▓Вр▓Яр│Ж'}</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <a href="tel:${p.mobile}" class="flex-1 bg-green-600 text-white text-center py-2 rounded-lg hover:bg-green-700 font-medium" style="text-decoration: none;">
                            ${t('call')}
                        </a>
                        ${p.lat && p.lng ? `
                            <a href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lng}" target="_blank" class="flex-1 bg-blue-600 text-white text-center py-2 rounded-lg hover:bg-blue-700 font-medium" style="text-decoration: none;">
                                ${t('directions')}
                            </a>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            document.getElementById('providersSection').classList.remove('hidden');
        }
        
        function getWorkingHoursLabel(hours) {
            const labels = {
                'mon-fri': 'ЁЯУЕ Mon-Fri',
                'weekends': 'ЁЯУЕ Weekends',
                'all-days': 'ЁЯУЕ All Days',
                '24x7': 'тП░ 24├Ч7'
            };
            return labels[hours] || hours;
        }
        
        // ==================== PHASE C: VOICE SEARCH ====================
        let recognition = null;
        let recognitionTimeout = null;
        
        function startVoiceSearch() {
            // Check browser support
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice search is not supported in your browser. Please use Chrome, Edge, or Safari.');
                return;
            }
            
            // Initialize speech recognition
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            // Configure recognition based on current language
            const langCodes = {
                'en': 'en-IN',
                'hi': 'hi-IN',
                'bn': 'bn-IN',
                'gu': 'gu-IN',
                'mr': 'mr-IN',
                'kn': 'kn-IN'
            };
            recognition.lang = langCodes[currentLanguage] || 'en-IN';
            recognition.continuous = false;
            recognition.interimResults = true; // CHANGED: Enable interim results
            recognition.maxAlternatives = 1;
            
            // Show listening indicator
            document.getElementById('voiceStatus').classList.remove('hidden');
            document.getElementById('voiceStatusText').textContent = t('speak');
            
            // Set timeout to auto-stop after 10 seconds
            recognitionTimeout = setTimeout(() => {
                if (recognition) {
                    recognition.stop();
                    document.getElementById('voiceStatus').classList.add('hidden');
                }
            }, 10000);
            
            recognition.onstart = function() {
                console.log('Speech recognition started');
                document.getElementById('voiceStatusText').textContent = t('listening');
            };
            
            recognition.onspeechstart = function() {
                console.log('Speech detected');
                document.getElementById('voiceStatusText').textContent = t('listening');
            };
            
            recognition.onspeechend = function() {
                console.log('Speech ended');
            };
            
            recognition.onresult = function(event) {
                // Clear the timeout since we got a result
                if (recognitionTimeout) {
                    clearTimeout(recognitionTimeout);
                }
                
                // Get the final transcript
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        transcript = event.results[i][0].transcript;
                        break;
                    }
                }
                
                // If no final result yet, use interim
                if (!transcript && event.results.length > 0) {
                    transcript = event.results[event.results.length - 1][0].transcript;
                }
                
                console.log('Voice input:', transcript);
                
                if (transcript.trim()) {
                    document.getElementById('voiceStatusText').textContent = t('searchingFor', { service: transcript });
                    
                    // Process the voice command
                    setTimeout(() => {
                        processVoiceCommand(transcript.toLowerCase());
                    }, 500);
                    
                    // Hide status after 2 seconds
                    setTimeout(() => {
                        document.getElementById('voiceStatus').classList.add('hidden');
                    }, 2000);
                } else {
                    document.getElementById('voiceStatus').classList.add('hidden');
                    alert(t('noSpeechDetected'));
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                
                // Clear timeout
                if (recognitionTimeout) {
                    clearTimeout(recognitionTimeout);
                }
                
                document.getElementById('voiceStatus').classList.add('hidden');
                
                if (event.error === 'no-speech') {
                    alert(t('noSpeechDetected'));
                } else if (event.error === 'not-allowed' || event.error === 'permission-denied') {
                    alert('Microphone access denied. Please allow microphone access in your browser settings.');
                } else if (event.error === 'aborted') {
                    // Silent error, likely user cancelled
                    console.log('Recognition aborted');
                } else {
                    alert('Voice recognition error: ' + event.error);
                }
            };
            
            recognition.onend = function() {
                console.log('Speech recognition ended');
                if (recognitionTimeout) {
                    clearTimeout(recognitionTimeout);
                }
            };
            
            // Start listening
            try {
                recognition.start();
                console.log('Recognition started successfully');
            } catch (e) {
                console.error('Error starting recognition:', e);
                document.getElementById('voiceStatus').classList.add('hidden');
                alert('Could not start voice recognition. Please try again.');
            }
        }
        
        function processVoiceCommand(transcript) {
            console.log('Processing command:', transcript);
            
            // Clean up the transcript - remove filler words
            const fillerWords = ['find', 'show', 'get', 'need', 'want', 'search', 'looking for', 'i need', 'get me', 'show me'];
            let cleanedTranscript = transcript.toLowerCase().trim();
            
            // Remove filler words to extract the actual service
            fillerWords.forEach(filler => {
                cleanedTranscript = cleanedTranscript.replace(filler, '').trim();
            });
            
            // Also remove articles
            cleanedTranscript = cleanedTranscript.replace(/\b(a|an|the)\b/g, '').trim();
            
            console.log('Cleaned transcript:', cleanedTranscript);
            
            // Service keywords in multiple languages (expanded list)
            const serviceKeywords = {
                // English - Plumbing
                'plumber': 'Pipe Repair',
                'plumbing': 'Pipe Repair',
                'pipe': 'Pipe Repair',
                'tap': 'Tap Installation',
                'tank': 'Tank Installation',
                'drainage': 'Drainage Cleaning',
                
                // English - Electrical
                'electrician': 'Wiring',
                'electrical': 'Wiring',
                'electricity': 'Wiring',
                'wiring': 'Wiring',
                'wire': 'Wiring',
                'light': 'Light Installation',
                'lights': 'Light Installation',
                'fan': 'Fan Installation',
                'ac': 'AC Installation',
                'air conditioning': 'AC Installation',
                
                // English - Carpentry
                'carpenter': 'Furniture Repair',
                'carpentry': 'Furniture Repair',
                'furniture': 'Furniture Repair',
                'wood': 'Wood Polishing',
                
                // English - Cleaning
                'cleaner': 'House Cleaning',
                'cleaning': 'House Cleaning',
                'clean': 'House Cleaning',
                'maid': 'House Cleaning',
                'housekeeping': 'House Cleaning',
                
                // English - Painting
                'painter': 'Wall Painting',
                'painting': 'Wall Painting',
                'paint': 'Wall Painting',
                
                // English - Other
                'mechanic': 'Car Repair',
                'car': 'Car Repair',
                'vehicle': 'Car Repair',
                
                // Hindi
                'рдкреНрд▓рдВрдмрд░': 'Pipe Repair',
                'рдирд▓': 'Tap Installation',
                'рдЗрд▓реЗрдХреНрдЯреНрд░реАрд╢рд┐рдпрди': 'Wiring',
                'рдмрдврд╝рдИ': 'Furniture Repair',
                'рд╕рдлрд╛рдИ': 'House Cleaning',
                'рдкреЗрдВрдЯрд░': 'Wall Painting'
            };
            
            // Find matching service - first try the cleaned transcript
            let matchedService = null;
            let matchedCategory = null;
            let matchedSubcategory = null;
            
            // Try both original and cleaned transcript
            const transcriptsToTry = [cleanedTranscript, transcript];
            
            for (const testTranscript of transcriptsToTry) {
                // Try to match keywords
                for (const keyword in serviceKeywords) {
                    // Check if keyword is in the transcript (exact match or contains)
                    if (testTranscript === keyword || testTranscript.includes(keyword)) {
                        const targetServiceName = serviceKeywords[keyword];
                        console.log('Matched keyword:', keyword, 'Target service:', targetServiceName);
                        
                        // Search through categories for this exact service
                        outerLoop: for (const cat of categories) {
                            for (let subIdx = 0; subIdx < cat.subcategories.length; subIdx++) {
                                const sub = cat.subcategories[subIdx];
                                for (let serviceIdx = 0; serviceIdx < sub.subsubcategories.length; serviceIdx++) {
                                    const service = sub.subsubcategories[serviceIdx];
                                    const serviceNameEn = service.name.en || service.name;
                                    
                                    console.log('Checking service:', serviceNameEn, 'vs target:', targetServiceName);
                                    
                                    // Exact match or contains check
                                    if (serviceNameEn === targetServiceName || serviceNameEn.includes(targetServiceName) || targetServiceName.includes(serviceNameEn)) {
                                        matchedCategory = cat.id;
                                        matchedSubcategory = subIdx;
                                        matchedService = serviceIdx;
                                        console.log('тЬЕ MATCHED! Category:', cat.id, 'Sub:', subIdx, 'Service:', serviceIdx, 'Name:', serviceNameEn);
                                        break outerLoop;
                                    }
                                }
                            }
                        }
                        
                        if (matchedService !== null) break;
                    }
                }
                
                if (matchedService !== null) break;
            }
            
            // If service found, navigate to browse and show results
            if (matchedService !== null) {
                console.log('ЁЯОп Final navigation:', matchedCategory, matchedSubcategory, matchedService);
                
                // Navigate programmatically to the service
                navigateToService(matchedCategory, matchedSubcategory, matchedService);
            } else {
                // If no match found, provide helpful error
                console.log('No service matched for:', transcript, '(cleaned:', cleanedTranscript + ')');
                
                // Show helpful message with examples
                const exampleServices = ['plumber', 'electrician', 'carpenter', 'cleaner', 'painter'];
                const randomExample = exampleServices[Math.floor(Math.random() * exampleServices.length)];
                
                alert(`Could not find "${transcript}". \n\nTry saying just the service name:\nтАв "${randomExample}"\nтАв "find a ${randomExample}"\nтАв "show ${randomExample}"`);
                showPage('browse');
            }
        }
        
        // ==================== PROGRAMMATIC NAVIGATION FOR VOICE ====================
        function navigateToService(catId, subIdx, serviceIdx) {
            // Set the selected values
            selectedCategoryId = catId;
            selectedSubcategoryIdx = subIdx;
            selectedServiceIdx = serviceIdx;
            
            // Navigate to browse page
            showPage('browse');
            
            // Wait for page to load, then populate everything
            setTimeout(() => {
                // Load browse categories first
                loadBrowseCategories();
                
                // Find and display the category
                const category = categories.find(c => c.id === catId);
                if (!category) {
                    console.error('Category not found:', catId);
                    return;
                }
                
                // Show subcategories
                const subcatGrid = document.getElementById('browseSubcategoriesGrid');
                subcatGrid.innerHTML = category.subcategories.map((sub, idx) => `
                    <div class="category-card bg-white p-6 rounded-xl shadow-md text-center ${idx === subIdx ? 'ring-4 ring-orange-500' : ''}" onclick="selectSubcategory(${idx})">
                        <div class="text-4xl mb-3">${sub.icon}</div>
                        <div class="font-bold text-gray-800">${getTranslated(sub.name)}</div>
                    </div>
                `).join('');
                document.getElementById('subcategorySection').classList.remove('hidden');
                
                // Show services
                const subcategory = category.subcategories[subIdx];
                const serviceGrid = document.getElementById('browseServicesGrid');
                serviceGrid.innerHTML = subcategory.subsubcategories.map((service, idx) => `
                    <div class="category-card bg-white p-6 rounded-xl shadow-md text-center ${idx === serviceIdx ? 'ring-4 ring-orange-500' : ''}" onclick="selectService(${idx})">
                        <div class="text-4xl mb-3">${service.icon}</div>
                        <div class="font-bold text-gray-800">${getTranslated(service.name)}</div>
                    </div>
                `).join('');
                document.getElementById('serviceSection').classList.remove('hidden');
                
                // Load providers immediately
                setTimeout(() => {
                    console.log('Voice navigation: Loading providers for service');
                    applySortAndFilter();
                    
                    // Scroll to providers section
                    setTimeout(() => {
                        const providersSection = document.getElementById('providersSection');
                        if (providersSection && !providersSection.classList.contains('hidden')) {
                            providersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 300);
                }, 200);
            }, 300);
        }
        
        function getDirections(lat, lng) {
            window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
        }
        
        // ==================== HOME PAGE ====================
        function loadHomeCategories() {
            const grid = document.getElementById('categoriesGridHome');
            grid.innerHTML = categories.map(cat => `
                <div class="bg-white p-6 rounded-xl shadow-md text-center hover:shadow-lg transition cursor-pointer" onclick="goToBrowse('${cat.id}')">
                    <div class="text-4xl mb-2">${cat.icon}</div>
                    <div class="font-semibold">${getTranslated(cat.name)}</div>
                </div>
            `).join('');
        }
        
        function goToBrowse(catId) {
            showPage('browse');
            setTimeout(() => selectCategory(catId), 100);
        }
        
        // ==================== MAPS ====================
        function initRegisterMap() {
            if (maps.register) return;
            
            maps.register = L.map('registerMap').setView([20.5937, 78.9629], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(maps.register);
            
            const marker = L.marker([20.5937, 78.9629], { draggable: true }).addTo(maps.register);
            
            marker.on('dragend', function(e) {
                const pos = e.target.getLatLng();
                document.getElementById('providerLat').value = pos.lat;
                document.getElementById('providerLng').value = pos.lng;
            });
            
            maps.register.on('click', function(e) {
                marker.setLatLng(e.latlng);
                document.getElementById('providerLat').value = e.latlng.lat;
                document.getElementById('providerLng').value = e.latlng.lng;
            });
            
            document.getElementById('providerLat').value = 20.5937;
            document.getElementById('providerLng').value = 78.9629;
        }
        
        function initSeekerMap() {
            if (maps.seeker) return;
            
            maps.seeker = L.map('seekerMap').setView([20.5937, 78.9629], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(maps.seeker);
            
            const marker = L.marker([20.5937, 78.9629], { draggable: true }).addTo(maps.seeker);
            
            marker.on('dragend', function(e) {
                const pos = e.target.getLatLng();
                document.getElementById('seekerLat').value = pos.lat;
                document.getElementById('seekerLng').value = pos.lng;
            });
            
            maps.seeker.on('click', function(e) {
                marker.setLatLng(e.latlng);
                document.getElementById('seekerLat').value = e.latlng.lat;
                document.getElementById('seekerLng').value = e.latlng.lng;
            });
            
            document.getElementById('seekerLat').value = 20.5937;
            document.getElementById('seekerLng').value = 78.9629;
        }
        
        function initMainMap() {
            if (maps.main) maps.main.remove();
            
            maps.main = L.map('mainMap').setView([20.5937, 78.9629], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(maps.main);
            
            providers.forEach(p => {
                if (p.lat && p.lng) {
                    const icon = L.divIcon({ html: '<div style="font-size: 30px;">ЁЯФз</div>', className: '', iconSize: [30, 30] });
                    const marker = L.marker([p.lat, p.lng], { icon }).addTo(maps.main);
                    marker.bindPopup(`<strong>${p.name}</strong><br>${p.service}<br>тВ╣${p.rate}/hr`);
                }
            });
        }
        
        // ==================== CATEGORY SELECTS ====================
        function updateProviderCategorySelects() {
            const select = document.getElementById('providerCategory');
            if (select) {
                select.innerHTML = '<option value="">Select Category</option>' + 
                    categories.map(cat => `<option value="${cat.id}">${getTranslated(cat.name)}</option>`).join('');
            }
        }
        
        function updateProviderSubcategories() {
            const catId = document.getElementById('providerCategory').value;
            const subSelect = document.getElementById('providerSubcategory');
            const category = categories.find(c => c.id === catId);
            
            if (category && category.subcategories) {
                subSelect.innerHTML = '<option value="">Select Subcategory</option>' + 
                    category.subcategories.map((sub, idx) => `<option value="${idx}">${getTranslated(sub.name)}</option>`).join('');
            } else {
                subSelect.innerHTML = '<option value="">Select Subcategory</option>';
            }
            document.getElementById('providerSubSubcategory').innerHTML = '<option value="">Select Service Type</option>';
        }
        
        function updateProviderSubSubcategories() {
            const catId = document.getElementById('providerCategory').value;
            const subIdx = document.getElementById('providerSubcategory').value;
            const subSubSelect = document.getElementById('providerSubSubcategory');
            
            const category = categories.find(c => c.id === catId);
            if (category && category.subcategories && category.subcategories[subIdx] && category.subcategories[subIdx].subsubcategories) {
                subSubSelect.innerHTML = '<option value="">Select Service Type</option>' + 
                    category.subcategories[subIdx].subsubcategories.map((subsub, idx) => 
                        `<option value="${idx}">${getTranslated(subsub.name)}</option>`
                    ).join('');
            } else {
                subSubSelect.innerHTML = '<option value="">Select Service Type</option>';
            }
        }
        
        // ==================== FORM SUBMISSIONS ====================
        document.getElementById('providerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const catId = document.getElementById('providerCategory').value;
            const subIdx = document.getElementById('providerSubcategory').value;
            const subSubIdx = document.getElementById('providerSubSubcategory').value;
            
            // Service is now optional - provider can register without it
            let serviceName = 'General Service Provider';
            if (catId && subIdx && subSubIdx) {
                const category = categories.find(c => c.id === catId);
                const subcategory = category?.subcategories[subIdx];
                const subsubcategory = subcategory?.subsubcategories[subSubIdx];
                serviceName = getTranslated(subsubcategory?.name) || serviceName;
            }
            
            const provider = {
                id: 'p_' + Date.now(),
                name: document.getElementById('providerName').value,
                mobile: document.getElementById('providerMobile').value,
                categoryId: catId || null,
                subcategoryIdx: subIdx || null,
                subsubcategoryIdx: subSubIdx || null,
                service: serviceName,
                religion: document.getElementById('providerReligion').value,
                language: document.getElementById('providerLanguage').value, // PHASE B
                experience: parseInt(document.getElementById('providerExperience').value),
                rate: parseInt(document.getElementById('providerRate').value),
                workingHours: document.querySelector('input[name="workingHours"]:checked')?.value || 'mon-fri', // PHASE B
                serviceArea: document.querySelector('input[name="serviceArea"]:checked')?.value || '10km', // PHASE B
                location: document.getElementById('providerLocation').value,
                lat: parseFloat(document.getElementById('providerLat').value),
                lng: parseFloat(document.getElementById('providerLng').value),
                rating: 4.0 + Math.random(),
                status: 'active',
                registered: new Date().toISOString()
            };
            
            providers.push(provider);
            localStorage.setItem('providers', JSON.stringify(providers));
            
            document.getElementById('providerSuccess').classList.remove('hidden');
            document.getElementById('providerForm').reset();
            
            setTimeout(() => {
                document.getElementById('providerSuccess').classList.add('hidden');
                showPage('browse');
            }, 2000);
        });
        
        document.getElementById('seekerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const seeker = {
                id: 's_' + Date.now(),
                name: document.getElementById('seekerName').value,
                mobile: document.getElementById('seekerMobile').value,
                religion: document.getElementById('seekerReligion').value,
                location: document.getElementById('seekerLocation').value,
                lat: parseFloat(document.getElementById('seekerLat').value),
                lng: parseFloat(document.getElementById('seekerLng').value),
                status: 'active', // active, paused, restricted
                registered: new Date().toISOString()
            };
            
            seekers.push(seeker);
            localStorage.setItem('seekers', JSON.stringify(seekers));
            
            currentUser = seeker;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            document.getElementById('seekerSuccess').classList.remove('hidden');
            document.getElementById('seekerForm').reset();
            
            setTimeout(() => {
                document.getElementById('seekerSuccess').classList.add('hidden');
                showPage('browse');
            }, 2000);
        });
        
        // ==================== ADMIN ====================
        let currentEditCategoryIdx = null;
        let currentEditSubcategoryIdx = null;
        let currentEditServiceIdx = null;
        let modalMode = 'add';
        
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                updateAdminStats();
                showAdminTab('categories'); // Default tab
            } else {
                alert('Incorrect password!');
            }
        }
        
        function adminLogout() {
            document.getElementById('adminLogin').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
        }
        
        function showAdminTab(tabName) {
            // Hide all tabs
            document.getElementById('adminTab-users').classList.add('hidden');
            document.getElementById('adminTab-categories').classList.add('hidden');
            
            // Remove active state from all tab buttons
            document.getElementById('tab-users').classList.remove('border-orange-600', 'text-orange-600');
            document.getElementById('tab-categories').classList.remove('border-orange-600', 'text-orange-600');
            
            // Show selected tab
            document.getElementById('adminTab-' + tabName).classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('border-orange-600', 'text-orange-600');
            
            // Load data for the tab
            if (tabName === 'users') {
                loadProvidersList();
                loadSeekersList();
            } else if (tabName === 'categories') {
                loadAdminCategories();
            }
        }
        
        function updateAdminStats() {
            const restrictedCount = providers.filter(p => p.status === 'restricted').length + 
                                   seekers.filter(s => s.status === 'restricted').length;
            
            document.getElementById('totalProviders').textContent = providers.length;
            document.getElementById('totalSeekers').textContent = seekers.length;
            document.getElementById('totalCategories').textContent = categories.length;
            document.getElementById('totalRestricted').textContent = restrictedCount;
        }
        
        // ==================== PROVIDER MANAGEMENT ====================
        function loadProvidersList() {
            const list = document.getElementById('providersListAdmin');
            if (!list) return;
            
            if (providers.length === 0) {
                list.innerHTML = '<div class="text-center py-8 text-gray-500">No providers registered yet</div>';
                return;
            }
            
            renderProvidersList(providers);
        }
        
        function renderProvidersList(providersList) {
            const list = document.getElementById('providersListAdmin');
            
            list.innerHTML = providersList.map(p => {
                const statusColor = {
                    'active': 'bg-green-100 text-green-800',
                    'paused': 'bg-yellow-100 text-yellow-800',
                    'restricted': 'bg-red-100 text-red-800'
                };
                const status = p.status || 'active';
                
                return `
                    <div class="border rounded-lg p-4 ${status === 'restricted' ? 'bg-red-50 border-red-200' : status === 'paused' ? 'bg-yellow-50 border-yellow-200' : 'bg-white'}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="font-bold text-lg">${p.name}</h3>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColor[status]}">${status.toUpperCase()}</span>
                                </div>
                                <div class="grid md:grid-cols-2 gap-2 text-sm text-gray-600">
                                    <div>ЁЯУЮ ${p.mobile}</div>
                                    <div>ЁЯФз ${p.service}</div>
                                    <div>ЁЯУН ${p.location}</div>
                                    <div>тнР ${(p.rating || 4.0).toFixed(1)} | ЁЯХР ${p.experience} yrs | ЁЯТ░ тВ╣${p.rate}/hr</div>
                                    <div>${religionIcons[p.religion] || 'ЁЯЩП'} ${p.religion}</div>
                                    <div>ЁЯУЕ ${new Date(p.registered).toLocaleDateString()}</div>
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                ${status === 'active' ? `
                                    <button onclick="pauseProvider('${p.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm" title="Pause">тП╕я╕П Pause</button>
                                    <button onclick="restrictProvider('${p.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm" title="Restrict">ЁЯЪл Restrict</button>
                                ` : ''}
                                ${status === 'paused' ? `
                                    <button onclick="activateProvider('${p.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm" title="Activate">тЦ╢я╕П Activate</button>
                                    <button onclick="restrictProvider('${p.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm" title="Restrict">ЁЯЪл Restrict</button>
                                ` : ''}
                                ${status === 'restricted' ? `
                                    <button onclick="activateProvider('${p.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm" title="Activate">тЬЕ Activate</button>
                                ` : ''}
                                <button onclick="deleteProvider('${p.id}')" class="bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-800 text-sm" title="Delete">ЁЯЧСя╕П Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterProvidersList() {
            const search = document.getElementById('searchProviders').value.toLowerCase();
            const filtered = providers.filter(p => 
                p.name.toLowerCase().includes(search) ||
                p.mobile.includes(search) ||
                p.service.toLowerCase().includes(search) ||
                p.location.toLowerCase().includes(search)
            );
            renderProvidersList(filtered);
        }
        
        function pauseProvider(providerId) {
            if (confirm('тП╕я╕П Pause this provider? They will not appear in search results until reactivated.')) {
                const provider = providers.find(p => p.id === providerId);
                if (provider) {
                    provider.status = 'paused';
                    localStorage.setItem('providers', JSON.stringify(providers));
                    loadProvidersList();
                    updateAdminStats();
                }
            }
        }
        
        function restrictProvider(providerId) {
            if (confirm('ЁЯЪл Restrict this provider? They will be blocked from the platform.')) {
                const provider = providers.find(p => p.id === providerId);
                if (provider) {
                    provider.status = 'restricted';
                    localStorage.setItem('providers', JSON.stringify(providers));
                    loadProvidersList();
                    updateAdminStats();
                }
            }
        }
        
        function activateProvider(providerId) {
            const provider = providers.find(p => p.id === providerId);
            if (provider) {
                provider.status = 'active';
                localStorage.setItem('providers', JSON.stringify(providers));
                loadProvidersList();
                updateAdminStats();
            }
        }
        
        function deleteProvider(providerId) {
            if (confirm('ЁЯЧСя╕П PERMANENTLY DELETE this provider? This action cannot be undone!')) {
                providers = providers.filter(p => p.id !== providerId);
                localStorage.setItem('providers', JSON.stringify(providers));
                loadProvidersList();
                updateAdminStats();
            }
        }
        
        // ==================== SEEKER MANAGEMENT ====================
        function loadSeekersList() {
            const list = document.getElementById('seekersListAdmin');
            if (!list) return;
            
            if (seekers.length === 0) {
                list.innerHTML = '<div class="text-center py-8 text-gray-500">No seekers registered yet</div>';
                return;
            }
            
            renderSeekersList(seekers);
        }
        
        function renderSeekersList(seekersList) {
            const list = document.getElementById('seekersListAdmin');
            
            list.innerHTML = seekersList.map(s => {
                const statusColor = {
                    'active': 'bg-green-100 text-green-800',
                    'paused': 'bg-yellow-100 text-yellow-800',
                    'restricted': 'bg-red-100 text-red-800'
                };
                const status = s.status || 'active';
                
                return `
                    <div class="border rounded-lg p-4 ${status === 'restricted' ? 'bg-red-50 border-red-200' : status === 'paused' ? 'bg-yellow-50 border-yellow-200' : 'bg-white'}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="font-bold text-lg">${s.name}</h3>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColor[status]}">${status.toUpperCase()}</span>
                                </div>
                                <div class="grid md:grid-cols-2 gap-2 text-sm text-gray-600">
                                    <div>ЁЯУЮ ${s.mobile}</div>
                                    <div>ЁЯУН ${s.location}</div>
                                    <div>${religionIcons[s.religion] || 'ЁЯЩП'} ${s.religion}</div>
                                    <div>ЁЯУЕ ${new Date(s.registered).toLocaleDateString()}</div>
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                ${status === 'active' ? `
                                    <button onclick="pauseSeeker('${s.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm" title="Pause">тП╕я╕П Pause</button>
                                    <button onclick="restrictSeeker('${s.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm" title="Restrict">ЁЯЪл Restrict</button>
                                ` : ''}
                                ${status === 'paused' ? `
                                    <button onclick="activateSeeker('${s.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm" title="Activate">тЦ╢я╕П Activate</button>
                                    <button onclick="restrictSeeker('${s.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm" title="Restrict">ЁЯЪл Restrict</button>
                                ` : ''}
                                ${status === 'restricted' ? `
                                    <button onclick="activateSeeker('${s.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm" title="Activate">тЬЕ Activate</button>
                                ` : ''}
                                <button onclick="deleteSeeker('${s.id}')" class="bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-800 text-sm" title="Delete">ЁЯЧСя╕П Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterSeekersList() {
            const search = document.getElementById('searchSeekers').value.toLowerCase();
            const filtered = seekers.filter(s => 
                s.name.toLowerCase().includes(search) ||
                s.mobile.includes(search) ||
                s.location.toLowerCase().includes(search)
            );
            renderSeekersList(filtered);
        }
        
        function pauseSeeker(seekerId) {
            if (confirm('тП╕я╕П Pause this seeker? They will not be able to use the platform until reactivated.')) {
                const seeker = seekers.find(s => s.id === seekerId);
                if (seeker) {
                    seeker.status = 'paused';
                    localStorage.setItem('seekers', JSON.stringify(seekers));
                    loadSeekersList();
                    updateAdminStats();
                }
            }
        }
        
        function restrictSeeker(seekerId) {
            if (confirm('ЁЯЪл Restrict this seeker? They will be blocked from the platform.')) {
                const seeker = seekers.find(s => s.id === seekerId);
                if (seeker) {
                    seeker.status = 'restricted';
                    localStorage.setItem('seekers', JSON.stringify(seekers));
                    loadSeekersList();
                    updateAdminStats();
                }
            }
        }
        
        function activateSeeker(seekerId) {
            const seeker = seekers.find(s => s.id === seekerId);
            if (seeker) {
                seeker.status = 'active';
                localStorage.setItem('seekers', JSON.stringify(seekers));
                loadSeekersList();
                updateAdminStats();
            }
        }
        
        function deleteSeeker(seekerId) {
            if (confirm('ЁЯЧСя╕П PERMANENTLY DELETE this seeker? This action cannot be undone!')) {
                seekers = seekers.filter(s => s.id !== seekerId);
                localStorage.setItem('seekers', JSON.stringify(seekers));
                loadSeekersList();
                updateAdminStats();
            }
        }
        
        function loadAdminCategories() {
            const list = document.getElementById('categoriesListAdmin');
            if (!list) return;
            
            if (categories.length === 0) {
                list.innerHTML = '<div class="text-center py-12 text-gray-500"><p class="text-lg">No categories yet. Click "Add New Category" to get started!</p></div>';
                return;
            }
            
            list.innerHTML = categories.map((cat, catIdx) => `
                <div class="border-2 border-gray-200 rounded-xl p-4 hover:border-orange-300 transition">
                    <div class="flex items-center justify-between bg-orange-50 p-4 rounded-lg mb-3">
                        <div class="flex items-center gap-3">
                            <span class="text-4xl">${cat.icon}</span>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">${cat.name.en || cat.name}</h3>
                                <p class="text-sm text-gray-500">${(cat.subcategories || []).length} subcategories</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editCategory(${catIdx})" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 font-medium">тЬПя╕П Edit</button>
                            <button onclick="showAddSubcategoryModal(${catIdx})" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 font-medium">тЮХ Add Subcategory</button>
                            <button onclick="deleteCategory(${catIdx})" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 font-medium">ЁЯЧСя╕П Delete</button>
                        </div>
                    </div>
                    
                    <div class="ml-8 space-y-3">
                        ${(cat.subcategories || []).map((sub, subIdx) => `
                            <div class="border-l-4 border-blue-400 bg-blue-50 p-3 rounded-r-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-2xl">${sub.icon}</span>
                                        <div>
                                            <h4 class="font-bold text-gray-800">${sub.name.en || sub.name}</h4>
                                            <p class="text-xs text-gray-500">${(sub.subsubcategories || []).length} services</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="editSubcategory(${catIdx}, ${subIdx})" class="bg-blue-400 text-white px-3 py-1 rounded hover:bg-blue-500 text-sm">тЬПя╕П Edit</button>
                                        <button onclick="showAddServiceModal(${catIdx}, ${subIdx})" class="bg-green-400 text-white px-3 py-1 rounded hover:bg-green-500 text-sm">тЮХ Add Service</button>
                                        <button onclick="deleteSubcategory(${catIdx}, ${subIdx})" class="bg-red-400 text-white px-3 py-1 rounded hover:bg-red-500 text-sm">ЁЯЧСя╕П</button>
                                    </div>
                                </div>
                                
                                <div class="ml-6 space-y-1">
                                    ${(sub.subsubcategories || []).map((service, serviceIdx) => `
                                        <div class="flex items-center justify-between bg-white p-2 rounded hover:bg-gray-50">
                                            <div class="flex items-center gap-2">
                                                <span class="text-lg">${service.icon}</span>
                                                <span class="text-sm text-gray-700">${service.name.en || service.name}</span>
                                            </div>
                                            <div class="flex gap-1">
                                                <button onclick="editService(${catIdx}, ${subIdx}, ${serviceIdx})" class="bg-blue-300 text-white px-2 py-1 rounded hover:bg-blue-400 text-xs">тЬПя╕П</button>
                                                <button onclick="deleteService(${catIdx}, ${subIdx}, ${serviceIdx})" class="bg-red-300 text-white px-2 py-1 rounded hover:bg-red-400 text-xs">ЁЯЧСя╕П</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function resetToDefaults() {
            if (confirm('тЪая╕П This will delete all categories and restore defaults. Continue?')) {
                categories = [
                    {
                        id: 'cat1',
                        name: { en: 'Home Services' },
                        icon: 'ЁЯПа',
                        subcategories: [
                            {
                                name: { en: 'Plumbing' },
                                icon: 'ЁЯФз',
                                subsubcategories: [
                                    { name: { en: 'Pipe Repair' }, icon: 'ЁЯФз' },
                                    { name: { en: 'Tank Installation' }, icon: 'ЁЯТз' },
                                    { name: { en: 'Bathroom Fitting' }, icon: 'ЁЯЪ┐' }
                                ]
                            },
                            {
                                name: { en: 'Electrical' },
                                icon: 'тЪб',
                                subsubcategories: [
                                    { name: { en: 'Wiring' }, icon: 'ЁЯФМ' },
                                    { name: { en: 'Appliance Repair' }, icon: 'ЁЯФз' }
                                ]
                            }
                        ]
                    }
                ];
                localStorage.setItem('categories', JSON.stringify(categories));
                loadAdminCategories();
                updateAdminStats();
                updateProviderCategorySelects();
                alert('тЬЕ Categories reset to defaults!');
            }
        }
        
        // Category Modal Functions
        function showAddCategoryModal() {
            modalMode = 'add';
            currentEditCategoryIdx = null;
            document.getElementById('categoryModalTitle').textContent = 'Add New Category';
            document.getElementById('modalCategoryName').value = '';
            document.getElementById('modalCategoryIcon').value = '';
            document.getElementById('categoryModal').classList.remove('hidden');
        }
        
        function editCategory(catIdx) {
            modalMode = 'edit';
            currentEditCategoryIdx = catIdx;
            const cat = categories[catIdx];
            document.getElementById('categoryModalTitle').textContent = 'Edit Category';
            document.getElementById('modalCategoryName').value = cat.name.en || cat.name;
            document.getElementById('modalCategoryIcon').value = cat.icon;
            document.getElementById('categoryModal').classList.remove('hidden');
        }
        
        function saveCategoryModal() {
            const name = document.getElementById('modalCategoryName').value.trim();
            const icon = document.getElementById('modalCategoryIcon').value.trim();
            
            if (!name || !icon) {
                alert('Please fill in both fields');
                return;
            }
            
            if (modalMode === 'add') {
                categories.push({
                    id: 'cat' + Date.now(),
                    name: { en: name },
                    icon: icon,
                    subcategories: []
                });
            } else {
                if (typeof categories[currentEditCategoryIdx].name === 'string') {
                    categories[currentEditCategoryIdx].name = { en: name };
                } else {
                    categories[currentEditCategoryIdx].name.en = name;
                }
                categories[currentEditCategoryIdx].icon = icon;
            }
            
            localStorage.setItem('categories', JSON.stringify(categories));
            loadAdminCategories();
            updateAdminStats();
            updateProviderCategorySelects();
            closeCategoryModal();
        }
        
        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.add('hidden');
        }
        
        function deleteCategory(catIdx) {
            if (confirm('тЪая╕П Delete this entire category including all subcategories and services?')) {
                categories.splice(catIdx, 1);
                localStorage.setItem('categories', JSON.stringify(categories));
                loadAdminCategories();
                updateAdminStats();
                updateProviderCategorySelects();
            }
        }
        
        // Subcategory Modal Functions
        function showAddSubcategoryModal(catIdx) {
            modalMode = 'add';
            currentEditCategoryIdx = catIdx;
            currentEditSubcategoryIdx = null;
            document.getElementById('subcategoryModalTitle').textContent = 'Add New Subcategory';
            document.getElementById('modalSubcategoryName').value = '';
            document.getElementById('modalSubcategoryIcon').value = '';
            document.getElementById('subcategoryModal').classList.remove('hidden');
        }
        
        function editSubcategory(catIdx, subIdx) {
            modalMode = 'edit';
            currentEditCategoryIdx = catIdx;
            currentEditSubcategoryIdx = subIdx;
            const sub = categories[catIdx].subcategories[subIdx];
            document.getElementById('subcategoryModalTitle').textContent = 'Edit Subcategory';
            document.getElementById('modalSubcategoryName').value = sub.name.en || sub.name;
            document.getElementById('modalSubcategoryIcon').value = sub.icon;
            document.getElementById('subcategoryModal').classList.remove('hidden');
        }
        
        function saveSubcategoryModal() {
            const name = document.getElementById('modalSubcategoryName').value.trim();
            const icon = document.getElementById('modalSubcategoryIcon').value.trim();
            
            if (!name || !icon) {
                alert('Please fill in both fields');
                return;
            }
            
            if (modalMode === 'add') {
                if (!categories[currentEditCategoryIdx].subcategories) {
                    categories[currentEditCategoryIdx].subcategories = [];
                }
                categories[currentEditCategoryIdx].subcategories.push({
                    name: { en: name },
                    icon: icon,
                    subsubcategories: []
                });
            } else {
                const sub = categories[currentEditCategoryIdx].subcategories[currentEditSubcategoryIdx];
                if (typeof sub.name === 'string') {
                    sub.name = { en: name };
                } else {
                    sub.name.en = name;
                }
                sub.icon = icon;
            }
            
            localStorage.setItem('categories', JSON.stringify(categories));
            loadAdminCategories();
            updateProviderCategorySelects();
            closeSubcategoryModal();
        }
        
        function closeSubcategoryModal() {
            document.getElementById('subcategoryModal').classList.add('hidden');
        }
        
        function deleteSubcategory(catIdx, subIdx) {
            if (confirm('тЪая╕П Delete this subcategory including all its services?')) {
                categories[catIdx].subcategories.splice(subIdx, 1);
                localStorage.setItem('categories', JSON.stringify(categories));
                loadAdminCategories();
                updateProviderCategorySelects();
            }
        }
        
        // Service Modal Functions
        function showAddServiceModal(catIdx, subIdx) {
            modalMode = 'add';
            currentEditCategoryIdx = catIdx;
            currentEditSubcategoryIdx = subIdx;
            currentEditServiceIdx = null;
            document.getElementById('serviceModalTitle').textContent = 'Add New Service Type';
            document.getElementById('modalServiceName').value = '';
            document.getElementById('modalServiceIcon').value = '';
            document.getElementById('serviceModal').classList.remove('hidden');
        }
        
        function editService(catIdx, subIdx, serviceIdx) {
            modalMode = 'edit';
            currentEditCategoryIdx = catIdx;
            currentEditSubcategoryIdx = subIdx;
            currentEditServiceIdx = serviceIdx;
            const service = categories[catIdx].subcategories[subIdx].subsubcategories[serviceIdx];
            document.getElementById('serviceModalTitle').textContent = 'Edit Service Type';
            document.getElementById('modalServiceName').value = service.name.en || service.name;
            document.getElementById('modalServiceIcon').value = service.icon;
            document.getElementById('serviceModal').classList.remove('hidden');
        }
        
        function saveServiceModal() {
            const name = document.getElementById('modalServiceName').value.trim();
            const icon = document.getElementById('modalServiceIcon').value.trim();
            
            if (!name || !icon) {
                alert('Please fill in both fields');
                return;
            }
            
            if (modalMode === 'add') {
                if (!categories[currentEditCategoryIdx].subcategories[currentEditSubcategoryIdx].subsubcategories) {
                    categories[currentEditCategoryIdx].subcategories[currentEditSubcategoryIdx].subsubcategories = [];
                }
                categories[currentEditCategoryIdx].subcategories[currentEditSubcategoryIdx].subsubcategories.push({
                    name: { en: name },
                    icon: icon
                });
            } else {
                const service = categories[currentEditCategoryIdx].subcategories[currentEditSubcategoryIdx].subsubcategories[currentEditServiceIdx];
                if (typeof service.name === 'string') {
                    service.name = { en: name };
                } else {
                    service.name.en = name;
                }
                service.icon = icon;
            }
            
            localStorage.setItem('categories', JSON.stringify(categories));
            loadAdminCategories();
            updateProviderCategorySelects();
            closeServiceModal();
        }
        
        function closeServiceModal() {
            document.getElementById('serviceModal').classList.add('hidden');
        }
        
        function deleteService(catIdx, subIdx, serviceIdx) {
            if (confirm('тЪая╕П Delete this service type?')) {
                categories[catIdx].subcategories[subIdx].subsubcategories.splice(serviceIdx, 1);
                localStorage.setItem('categories', JSON.stringify(categories));
                loadAdminCategories();
                updateProviderCategorySelects();
            }
        }
        
        // ==================== AUTO-LOCATION ====================
        function useMyLocation(type) {
            if (!navigator.geolocation) {
                alert('тЭМ Geolocation not supported by your browser.\n\nPlease click on the map to set your location manually.');
                return;
            }
            
            const button = event.target;
            button.innerHTML = 'тП│ Detecting...';
            button.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    console.log('Location detected:', lat, lng);
                    
                    if (type === 'provider') {
                        document.getElementById('providerLat').value = lat;
                        document.getElementById('providerLng').value = lng;
                        
                        if (maps.register) {
                            maps.register.setView([lat, lng], 13);
                            maps.register.eachLayer(layer => {
                                if (layer instanceof L.Marker) {
                                    layer.setLatLng([lat, lng]);
                                }
                            });
                        }
                    } else if (type === 'seeker') {
                        document.getElementById('seekerLat').value = lat;
                        document.getElementById('seekerLng').value = lng;
                        
                        if (maps.seeker) {
                            maps.seeker.setView([lat, lng], 13);
                            maps.seeker.eachLayer(layer => {
                                if (layer instanceof L.Marker) {
                                    layer.setLatLng([lat, lng]);
                                }
                            });
                        }
                    }
                    
                    button.innerHTML = 'тЬУ Location Detected!';
                    setTimeout(() => {
                        button.innerHTML = 'ЁЯУН Use My Location';
                        button.disabled = false;
                    }, 2000);
                    
                    alert('тЬУ Your location has been detected and set on the map!');
                },
                function(error) {
                    console.error('Geolocation error:', error);
                    
                    let errorMsg = 'тЭМ Could not detect location.\n\n';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'Please allow location access in your browser settings.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'Location information unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'Location request timed out.';
                            break;
                        default:
                            errorMsg += 'An unknown error occurred.';
                    }
                    errorMsg += '\n\nPlease click on the map to set location manually.';
                    
                    alert(errorMsg);
                    
                    button.innerHTML = 'ЁЯУН Use My Location';
                    button.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        
        // ==================== INITIALIZATION ====================
        function initializeApp() {
            if (!localStorage.getItem('categories')) {
                localStorage.setItem('categories', JSON.stringify(categories));
            }
            
            initializeTranslations(); // Mark translatable elements
            updateProviderCategorySelects();
            updateAllUIText(); // Apply translations on init
            showPage('home');
        }
        
        window.onload = function() {
            const langNames = {
                'en': 'EN',
                'hi': 'рд╣рд┐рдВ',
                'bn': 'ржмрж╛ржВ',
                'gu': 'ркЧрлБркЬ',
                'mr': 'рдорд░рд╛',
                'kn': 'р▓Хр▓ир│Нр▓и'
            };
            
            if (!localStorage.getItem('language')) {
                // First time - show language selector
                document.getElementById('languageModal').classList.remove('hidden');
            } else {
                // Language already selected - load it
                currentLanguage = localStorage.getItem('language');
                document.getElementById('currentLang').textContent = langNames[currentLanguage] || 'EN';
                initializeApp();
            }
        };
    </script>
</body>
</html>
